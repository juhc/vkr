# Платформа киберучений по защите операционных систем

> **Важно**: Проект использует веточную модель, где каждый учебный сценарий находится в отдельной ветке Git. См. [BRANCHES.md](BRANCHES.md) для подробной информации о структуре веток.

## Быстрый старт

Для работы с конкретным сценарием переключитесь на соответствующую ветку:
```bash
# Сценарий ISP-компании
git checkout scenario-isp-company

# Сценарий офисной организации
git checkout scenario-office-organization
```

---

В современном мире кибербезопасности наблюдается устойчивая тенденция роста инцидентов, связанных с эксплуатацией известных уязвимостей операционных систем и программного обеспечения. Согласно отчету Verizon DBIR 2024, число взломов посредством уязвимостей резко возросло – компрометация через уязвимости (например, незащищенные сети или сервисы) составила около 14% всех утечек данных в 2023 году, что почти втрое больше, чем годом ранее
njbia.org
. Многие из этих атак используют давно известные уязвимости, для которых уже существуют исправления. Так, по данным исследования Ponemon Institute, 60% компаний, пострадавших от утечек, признали, что причиной инцидента стали известные уязвимости, которые не были вовремя устранены патчами
prowritersins.com
. Показательно, что даже нашумевшие уязвимости прошлых лет, такие как Log4Shell (CVE-2021-44228), до сих пор входят в перечень наиболее эксплуатируемых уязвимостей (на 2023 год)
picussecurity.com
 – это указывает на сохраняющиеся проблемы с обновлением систем и управлением патчами.

Кроме того, человеческий фактор по-прежнему играет огромную роль в нарушениях безопасности: до 68% утечек данных связаны с ошибками персонала или социальными атаками (фишинг и пр.)
njbia.org
. Администраторы зачастую совершают типичные ошибки настройки и эксплуатации систем, которые открывают путь злоумышленникам. Например, оставление лишних сетевых портов открытыми – одна из самых распространенных ошибок администрирования, способная привести к серьезным проблемам безопасности
linuxsecurity.com
. В условиях, когда количество уязвимостей растет, а атаки становятся все более изощренными, обеспечение практической подготовки специалистов в области защиты операционных систем приобретает особую актуальность. Необходимо обучать будущих администраторов и инженеров кибербезопасности выявлять и устранять уязвимости, правильно конфигурировать системы и оперативно реагировать на инциденты. Создание полигона для киберучений по защите ОС отвечает этой потребности, позволяя отработать навыки в близи к реальным условиям без риска для рабочих сетей.

Постановка проблемы

Проблема заключается в отсутствии готовой инфраструктуры и методологии для проведения практических киберучений по безопасности операционных систем, особенно в учебном процессе. В рамках курса "Защита ОС" требуется площадка, на которой студенты или специалисты смогут безопасно имитировать атаки и инциденты, изучать уязвимости и отрабатывать навыки реагирования. Традиционно создание таких лабораторных стендов осуществляется вручную: настройка виртуальных машин, установка уязвимого ПО, внесение намеренных ошибок конфигурации – все это отнимает много времени и сил. Практика показывает, что значительная доля времени уходит на ручное развертывание и настройку лабораторий, из-за чего страдает их консистентность и повторяемость
dev.to
. Отсутствие автоматизации ведет к тому, что разные группы получают различающийся опыт, а обновление или масштабирование окружения превращается в трудоемкую задачу.

Другой аспект проблемы – недостаточная систематизация знаний об инцидентах и уязвимостях. Администраторам сложно держать в голове все последние угрозы: наиболее часто эксплуатируемые уязвимости разбросаны по разным источникам, а основные ошибки настройки (пароли по умолчанию, несвоевременное обновление, избыточные права и др.) повторяются из года в год. Без единого подхода к документированию и воспроизведению таких сценариев обучения упускаются важные уроки.

Таким образом, назрела необходимость решения, которое позволит: 1) быстро и единообразно развертывать учебные инфраструктуры для киберупражнений по защите ОС; 2) хранить описания этих инфраструктур в систематизированном виде (в репозитории), чтобы накапливать знания об инцидентах; 3) включать в сценарии наиболее актуальные уязвимости и типичные ошибки администрирования. Решение должно обеспечить изоляцию учебного полигона (как своего рода «cyber range» – безопасного полигона для экспериментов
hashicorp.com
), чтобы студенты могли безопасно исследовать атаки (например, работу вредоносного ПО) без риска для внешней сети. При этом крайне важно добиться полной автоматизации развёртывания: как отмечается практиками, при проведении соревнований типа CTF киберполигоны должны автоматически поднимать сотни виртуальных машин и десятки сетей, иначе организаторы просто не успеют создать условия для всех участников
hashicorp.com
. Без автоматизации масштабирование подобных упражнений и регулярное повторное развертывание перед каждым занятием были бы практически нереализуемы.

Архитектура решения

Для решения обозначенных проблем предлагается архитектура, основанная на принципах Infrastructure as Code и конфигурационного управления. Проект ориентирован на выполнение в рамках выпускной квалификационной работы специалитета, причем платформа будет развертываться локально (в среде виртуализации учебной лаборатории). В реализации используются два ключевых инструмента: Terraform – для автоматизированного развёртывания и масштабирования инфраструктуры, и Ansible – для конфигурации операционных систем и сервисов на развёрнутых узлах. Такой подход позволит описать всю лабораторную среду в виде кода, хранить её в системе контроля версий и вносить изменения воспроизводимым способом. Автоматизация повторяющихся операций посредством Ansible и Terraform не только экономит время, но и развивает навыки, востребованные в индустрии
cybrary.it
, что является дополнительным образовательным эффектом.

Структура хранения инфраструктур: все описания будут находиться в централизованном Git-репозитории. Для удобства каждая отдельная инфраструктура (сценарий учений) размещается в отдельной ветке репозитория. Это значит, что, например, для сценария A (учебная ситуация с определенным набором уязвимостей) имеется своя ветка с Terraform/Ansible конфигурациями; для сценария B – другая ветка и т.д. Такой подход упрощает управление версиями: можно параллельно разрабатывать и модифицировать разные сценарии, не смешивая их конфигурации. Хранение кода инфраструктуры в репозитории также соответствует принципам DevOps/DevSecOps, в рамках которых инфраструктура подчиняется тем же процессам контроля качества, что и программный код. Это создает возможность интеграции средств статического анализа и тестирования безопасности прямо в цикл разработки инфраструктуры (так называемый shift-left подход, когда проверки выполняются на ранних этапах)
checkpoint.com
. В перспективе, внедрение DevSecOps-культуры обеспечит более надежные и проверенные на уязвимости конфигурации еще до их развёртывания в боевые среды.

Terraform для развёртывания: Terraform используется для программного описания нужных вычислительных ресурсов и их автоматического создания. Локально это могут быть, например, виртуальные машины в среде VMware Workstation, VirtualBox или KVM (либо контейнеры, если уместно). Terraform-конфигурация задает состав сценария: сколько и какие узлы нужны, как они соединены сетью, параметры каждой ВМ (образ ОС, ресурсы) и т.п. При применении (apply) Terraform самостоятельно создаст указанное количество виртуальных машин и настроит виртуальные сети. Практически это аналогично тому, как Terraform применяют в облаке: в одном из решений Terraform развертывал целую лабораторию в AWS (EC2-инстансы, сети и прочие ресурсы), после чего вызывал Ansible для настройки ПО на каждом инстансе
dev.to
. Наша платформа реализует тот же принцип, но акцент сделан на локальное развертывание для обучения (хотя при необходимости конфигурации могут быть перенастроены и под облачного провайдера). Использование Terraform обеспечивает масштабируемость – добавить новый узел или даже целый сценарий можно, описав несколько строк кода, что намного проще ручного создания. Также появляется гибкость: один и тот же сценарий можно развернуть сразу несколько раз (например, несколько одинаковых сред для разных команд студентов) – достаточно запустить конфигурацию с нужным количеством копий, и Terraform создаст все в единообразном виде.

Ansible для конфигурации ОС: после того, как инфраструктура (виртуальные машины) развернуты, вступает в дело Ansible. Он выполняет автоматическую настройку каждого узла согласно заданному сценарию. В репозитории для каждой инфраструктуры будет подготовлен набор плейбуков Ansible, которые устанавливают необходимое программное обеспечение, изменяют конфигурационные файлы, создают учетные записи и пр. – все шаги, необходимые для воспроизведения условий конкретного инцидента безопасности. К примеру, если сценарий предполагает уязвимый веб-сервер, Ansible автоматически развернет на целевой ВМ устаревшую версию веб-сервера с известной уязвимостью и настроит небезопасные параметры. Другой плейбук может, наоборот, имитировать типичную ошибку администратора – например, включит учетную запись с паролем по умолчанию или откроет в брандмауэре лишний порт. Благодаря Ansible все эти изменения выполняются скриптами, исключая человеческий фактор при настройке учебной среды. Подход с комбинацией Terraform+Ansible уже зарекомендовал себя для подобных задач: Terraform отвечает за “железо”, а Ansible – за “софт”, позволяя быстро переходить от пустых ВМ к полностью сконфигурированной лаборатории
dev.to
.

Важно отметить, что развёртывание лаборатории идемпотентно и повторяемо. В любой момент инфраструктуру можно уничтожить (Terraform destroy) и развернуть заново из репозитория, получив ту же самую конфигурацию. Это удобно для учебного процесса: после того как одна группа студентов “сломала” систему в ходе упражнений, преподаватель может одним действием восстановить исходное состояние для следующей группы. Также система контроля версий позволяет отслеживать эволюцию сценариев: например, по мере появления новых угроз можно обновлять сценарий (вносить новые уязвимости, исправлять ошибки) в новой ветке, не нарушая работоспособность прежних версий.

С архитектурной точки зрения, решение включает следующие компоненты: репозиторий кода инфраструктуры (шаблоны Terraform, плейбуки Ansible, документация), сервер управления (контроллер Ansible/Terraform, с которого запускается процесс деплоя – им может служить хост преподавателя или отдельная виртуальная машина), и набор целевых узлов (виртуальные машины сценария, которые Terraform создает и конфигурирует). Все коммуникации Ansible осуществляет по SSH (или WinRM для Windows-систем, если таковые предусмотрены) – агентless-архитектура Ansible упрощает поддержку, так как на целевых ВМ не требуется установка дополнительного ПО. Безопасность окружения обеспечивается изоляцией виртуальной сети: учебные ВМ будут запущены в сегменте, не имеющем доступа в интернет или к основной сети вуза. Это аналогично тому, как cyber range изолирует “полигон” от боевой сети
hashicorp.com
, что предотвращает возможное неконтролируемое распространение вредоносного трафика или аварий.

Таким образом, предложенная архитектура сочетает гибкость и автоматизацию Terraform с мощными возможностями Ansible по настройке ОС. Она реализует принцип «лаборатория как код», когда все – от инфраструктуры до последнего конфигурационного файла – описано декларативно и хранится в Git. Данный подход не только решает текущие задачи (подготовка киберучений), но и служит демонстрацией современных практик DevSecOps для студентов: они увидят, как благодаря IaC можно добиться быстрого выявления и устранения уязвимостей, повторяемости настроек и более эффективной реакции на инциденты
checkpoint.com
. Это способствует формированию культуры, где безопасность становится частью процесса разработки и эксплуатации с самых ранних этапов.

Техническое задание (проектные требования)

Для реализации описанной системы киберучений по защите ОС необходимо выполнить следующий комплекс работ и требований:

Разработка инфраструктурного репозитория. Создать репозиторий (например, на базе Git), в котором будут храниться все файлы, описывающие инфраструктуру и конфигурацию учебного полигона. Предусмотреть структуру репозитория с разделением сценариев по веткам – каждая ветка представляет отдельный набор инфраструктуры для конкретного кейса/задания.

Конфигурация Terraform для автоматического развёртывания. Разработать Terraform-модули и конфигурационные файлы, описывающие желаемую инфраструктуру учебного сценария. Минимальные требования: возможность развернуть заданное число виртуальных машин требуемого типа (например, серверы Linux/Windows с нужными версиями ОС), настройка виртуальной сети (сегментация, имитация сети предприятия при необходимости), создание необходимых ресурсов (например, дополнительных сетевых интерфейсов, правил брандмауэра). Terraform-конфигурации должны быть параметризуемыми, чтобы облегчить масштабирование – например, легко изменить количество узлов или характеристики ВМ. Код Terraform следует организовать в виде модулей для повторного использования в разных сценариях.

Автоматизация конфигурации ОС через Ansible. Создать набор Ansible-плейбуков (и при необходимости, ролей) для настройки развернутых виртуальных машин согласно сценарию учений. Плейбуки должны выполнять установку необходимого программного обеспечения (включая уязвимые версии приложений, имитирующие присутствие уязвимостей), внесение конфигурационных изменений (например, отключение обновлений, создание пользователей с слабыми паролями, открытие портов, изменение прав доступа и т.д. – в зависимости от моделируемой проблемы безопасности). Необходимо обеспечить идемпотентность плейбуков (повторный запуск не должен приводить к ошибкам) и их интеграцию с Terraform. Интеграция может быть выполнена через провайдер local-exec или аналогичный механизм: после создания ресурсов Terraform должен передать информацию (IP-адреса, учетные данные) Ansible для дальнейшей настройки
dev.to
. Например, Terraform может генерировать инвентарь для Ansible с перечнем созданных ВМ и затем вызывать ansible-playbook для применения ролей.

Система контроля версий и совместная работа. Настроить систему контроля версий таким образом, чтобы все изменения в инфраструктуре проходили через нее. Каждая ветка (сценарий) должна содержать README-файл с описанием сценария (цель учений, какие уязвимости или инциденты моделируются, какие узлы входят и пр.). Нужно документировать процесс слияния изменений (Pull Request) при доработке сценариев. Предусмотреть метки версий (теги) для фиксирования устойчивых версий сценариев, которые прошли проверку и готовы к использованию на занятиях.

Сценарии инцидентов и содержание учений. На основе изучения инцидентов информационной безопасности разработать не менее 2–3 учебных сценариев, каждый из которых фокусируется на определенном типе уязвимости или ошибке администрирования. Например: (а) сценарий атаки через неуправляемую уязвимость (эксплуатация непатченного сервера с уязвимостью из списка Top-15 по данным CISA
picussecurity.com
); (б) сценарий неправильно сконфигурированной системы (например, критичная служба, работающая с настройками по умолчанию, слабые пароли, или открытая S3-бакет/сетевая шара); (в) сценарий, имитирующий инсайдерскую ошибку или фишинговую атаку, приводящую к компрометации учетной записи. Для каждого сценария составить описание ожидаемого «инцидента» и перечень заданий для учащихся (например, обнаружить следы атаки в логах, исправить уязвимость, усилить настройки системы и т.д.). Эти задания должны тесно соответствовать конфигурации, развернутой Ansible (то есть действительно быть решаемыми на подготовленной инфраструктуре).

Тестирование и отладка развёртывания. Выполнить полное испытание разработанных Terraform/Ansible сценариев. Критерии приемки: инфраструктура разворачивается с нуля на чистой системе за приемлемое время; все шаги Ansible отрабатывают успешно и приводят систему в заданное уязвимое состояние; сценарий инцидента воспроизводим (например, известным эксплойтом можно воспользоваться на уязвимой машине, или неправильная настройка действительно генерирует аномалии, которые должен заметить студент). После этого проверить обратимый процесс: удаление инфраструктуры (Terraform destroy) не оставляет артефактов, и повторный деплой дает такое же окружение. В случае выявления ошибок (например, race condition при настройке или неполная идемпотентность) – скорректировать код.

Документация и инструкции. Разработать комплект документации по системе. В него должны войти: руководство администратора (как развернуть всю платформу локально, какие требования к хост-системе, настройка Terraform провайдеров, переменные окружения и т.п.); инструкция по добавлению нового сценария (шаблон или пример, как создать новую ветку, какие файлы необходимо сделать, как структурировать плейбуки и модули); методические указания для преподавателя и учащихся по проведению учений в каждом из сценариев (что должно быть сделано студентами, какие результаты ожидаются, критерии успеха). Документация должна быть включена в репозиторий и поддерживаться в актуальном состоянии по мере развития проекта.

Соответствие принципам безопасности и DevSecOps. Убедиться, что при разработке инфраструктуры соблюдаются базовые принципы безопасности: хранение чувствительных данных (например, паролей от тестовых учетных записей) в Ansible Vault или с помощью Terraform input variables (не в открытом виде в репозитории); использование актуальных образов ОС для снижения лишних уязвимостей (при том, что нужные намеренно уязвимые версии приложений устанавливаются контролируемо); минимизация прав доступа (например, если сценарий не требует интернет-доступа, ВМ не должны иметь его, и т.д.). Рекомендуется настроить средства автоматизированного сканирования – как минимум линтеры для Terraform и Ansible кода, возможно, подключить проверку известных уязвимостей в используемых образах (например, с помощью инструментов типа OpenSCAP или аналогичных в CI/CD конвейере). Эти меры интегрируют проект в культуру DevSecOps, где безопасность проверяется на каждом этапе разработки и развертывания.

Выполнение вышеуказанных пунктов позволит создать функционирующую платформу киберучений по защите ОС. Итоговая система предоставит локально развертываемый "киберполигон" для отработки навыков ИБ, где инфраструктура описана кодом, каждый сценарий отражает реальные угрозы (на основании анализа инцидентов), а автоматизация с помощью Terraform и Ansible обеспечивает быстрое и массовое развертывание учебных ситуаций. Такая платформа не только актуальна с практической точки зрения, но и демонстрирует современный подход к обеспечению безопасности информационных систем, сочетая обучение с применением DevSecOps-инструментов на практике.