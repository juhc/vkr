- name: Validate vuln_enabled IDs
  ansible.builtin.assert:
    that:
      - (vuln_enabled | default([])) is iterable
      - (vuln_enabled | difference(vuln_linux_known)) | length == 0
    fail_msg: >-
      Unknown Linux vulnerability IDs: {{
        (vuln_enabled | difference(vuln_linux_known)) | join(', ')
      }}.
      Known: {{ vuln_linux_known | join(', ') }}

- name: Ensure prerequisite packages for enabled vulnerabilities
  ansible.builtin.include_tasks: prerequisites.yml

- name: Apply enabled Linux vulnerabilities
  ansible.builtin.include_tasks: "vulns/{{ item }}.yml"
  loop: "{{ vuln_enabled }}"
  loop_control:
    label: "{{ item }}"

