- name: Read sshd effective config (passwordauthentication)
  ansible.builtin.command: sshd -T
  register: sshd_t_pass
  changed_when: false

- name: Verify password authentication setting
  ansible.builtin.assert:
    that:
      - (verify_mode == "enabled" and (sshd_t_pass.stdout is search('passwordauthentication yes')))
        or
        (verify_mode == "disabled" and (sshd_t_pass.stdout is search('passwordauthentication no')))
    fail_msg: >-
      SSH PasswordAuthentication check failed for mode {{ verify_mode }}.
