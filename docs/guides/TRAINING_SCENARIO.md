## Сценарий тренировки/обучения (VPN → Proxmox → ВМ стенда)

### Цель

Обучающийся получает доступ по **VPN** к Proxmox Web UI под **ограниченной учётной записью**, где доступны **только виртуальные машины его стенда**. Он сам **включает/выключает** нужные машины, работает через **консоль Proxmox** и/или по сети (SSH/RDP по политике курса), выполняет задания по аудиту и укреплению (hardening).

### Роли

- **Администратор киберучений**:
  - разворачивает стенд (Packer/Terraform/Ansible),
  - включает профили уязвимостей,
  - создаёт pool и выдаёт студенту права в Proxmox,
  - выдаёт VPN-конфиг.
- **Обучающийся**:
  - заходит в Proxmox и управляет только “своими” ВМ (Power + Console),
  - выполняет задания внутри ВМ,
  - сдаёт отчёт (доказательства + исправления + проверка).
- **Проверяющий/преподаватель**:
  - принимает отчёт,
  - проверяет чек‑листом или verify-командами.

### Доступ обучающегося к Proxmox

Рекомендуемая схема: **1 стенд = 1 pool**, студенту выдаются права только на `/pool/<stand-id>`.

Подробно: `docs/guides/PROXMOX_STUDENT_ACCESS.md`.

### Состав стенда (обязательное требование: AD)

**Domain Controller (AD) должен присутствовать всегда**, чтобы задания были “в доменной среде”:

- **DC**: Windows Server (роль AD DS), домен например `training.local`
- **Windows 10** (рабочая станция)
- **Windows Server** (член домена)
- (опционально) **Linux WS / Linux Server** (можно подключать к домену или оставить standalone)

### Подготовка стенда администратором (до выдачи студенту)

Справочно:
- каталог “что включено” и проверка: `docs/guides/VULNERABILITY_CATALOG.md`
- учебные мини‑сценарии по каждой уязвимости: `docs/guides/VULNERABILITY_SCENARIOS.md`

1) **Развернуть ВМ**:
   - `stands/windows-stand/infrastructure/scripts/deploy.sh`
   - (опционально) `stands/linux-stand/infrastructure/scripts/deploy.sh`

2) **Задать операторские учётки** (чтобы админ/преподаватель мог зайти и проверить):
   - `group_vars/all/accounts.yml` (см. `accounts.yml.example`)

3) **Включить/выключить присоединение к домену**:
   - `group_vars/all/ad.yml` (см. `ad.yml.example`)
   - `vkr_ad_join_profiles.<group>: true|false`

4) **Включить профили уязвимостей**:
   - `group_vars/all/vulnerabilities.yml`

5) **Выдать Proxmox доступ студенту**:
   - создать pool стенда,
   - добавить ВМ стенда в pool,
   - выдать роль с правами Power+Console (без VM.Config).

### Как проходит обучение (поток действий)

1) Студент подключается по **VPN**.
2) Заходит в **Proxmox Web UI** под своим аккаунтом и видит **только ВМ своего стенда**.
3) Включает необходимые ВМ (обычно: DC → Server → WS).
4) Открывает **консоли** и/или подключается по сети к ВМ (как определено в задании).
5) Выполняет задания, фиксирует “до/после”.
6) Сдаёт отчёт.

### Задания (примерная структура)

#### Блок A — Проверка доменной среды (AD must-have)

- Проверить, что домен существует и доступен:
  - Windows: статус домена/учётных записей, DNS на DC
  - Linux (если join включён): `realm list`, работа SSSD, разрешение имён домена
- Зафиксировать доказательства (скрин/команды/вывод).

#### Блок B — Аудит базовой безопасности

- Учетные записи и политики:
  - слабые пароли/отключенные политики,
  - лишние админ‑права,
  - гостевые/тестовые учётки.
- Обновления/защита:
  - отключенные обновления/Defender/Firewall,
  - небезопасные протоколы/службы.
- Логи и аудит:
  - выключенный аудит событий, отсутствие журналов.

#### Блок C — Исправление (hardening) и проверка

- Включить нужные политики/защиту.
- Удалить/ограничить лишние права.
- Отключить небезопасные службы/протоколы.
- Повторить проверки и зафиксировать “после”.

### Оценивание (минимальная модель)

- **40%** — корректное обнаружение (доказательства, без “угадывания”)
- **40%** — корректное исправление (минимально‑достаточно, без поломки доступа)
- **20%** — качество отчёта (повторяемость шагов, “до/после”)

### Что считать “доказательствами”

- команды и вывод (скопированный текст),
- скриншоты консоли Proxmox,
- журналы/скриншоты настроек,
- повторная проверка после исправлений.

