# Каталог уязвимостей (Ansible)

Документ описывает **уязвимости как модули**: каждая уязвимость имеет **ID**, относится к одной из тематических категорий и имеет понятную проверку “как увидеть, что уязвимость включена”.

Источник применения:
- Linux: роль `ansible/roles/vuln_linux`
- Windows: роль `ansible/roles/vuln_windows`

Включение/выключение делается списками ID в:
- `stands/<scenario>/infrastructure/ansible/group_vars/all/vulnerabilities.yml` → `vuln_profiles.*`

## Легенда

- **Категория**: тематический раздел из вашей классификации
- **Эффект**: что именно ослабляется/ломается для обучения

---

## Linux (роль `vuln_linux`)

### Таблица

| ID | Категория | Поддержка | Что делает | Как проверить |
|---|---:|---|---|---|
| `linux.auth.weak_root_password` | Аутентификация и парольные политики | Debian 13.3, Ubuntu Server 24.03 | Ставит слабый пароль для `root` | Попробовать SSH/консоль вход под `root` по паролю; sudo grep '^root:' /etc/shadow |
| `linux.auth.lockout_disabled` | Аутентификация и парольные политики | Debian 13.3, Ubuntu Server 24.03 | Отключает/ослабляет механизмы блокировки при переборе паролей (fail2ban/pam_faillock) | systemctl status fail2ban (stopped/disabled); поиск pam_faillock в /etc/pam.d/* |
| `linux.auth.no_password_policy` | Аутентификация и парольные политики | Debian 13.3, Ubuntu Server 24.03 | Ослабляет требования к паролям (pwquality/PAM), где это применимо | Debian/Ubuntu: /etc/security/pwquality.conf, /etc/pam.d/common-password; RHEL: /etc/pam.d/password-auth, /etc/pam.d/system-auth |
| `linux.auth.extra_admin_user` | Привилегии и контроль доступа | Debian 13.3, Ubuntu Server 24.03 | Создаёт лишнюю учётную запись с правами администратора в группе `sudo` | getent group sudo \| grep -i testadmin |
| `linux.sudo.nopasswd` | Привилегии и контроль доступа | Debian 13.3, Ubuntu Server 24.03 | Делает `sudo` без пароля для группы `sudo` | sudo -l (видно NOPASSWD:ALL) |
| `linux.priv.suid_bash_backdoor` | Привилегии и контроль доступа | Debian 13.3, Ubuntu Server 24.03 | Кладёт SUID-root bash `/usr/local/bin/trainingbash` (локальная эскалация) | ls -l /usr/local/bin/trainingbash (бит s); /usr/local/bin/trainingbash -p -c id |
| `linux.ssh.root_login` | Удалённый доступ | Debian 13.3, Ubuntu Server 24.03 | Разрешает SSH‑вход для `root` | sshd -T \| grep -i permitrootlogin |
| `linux.ssh.password_auth` | Удалённый доступ | Debian 13.3, Ubuntu Server 24.03 | Включает парольную SSH‑аутентификацию | sshd -T \| grep -i passwordauthentication |
| `linux.ssh.no_rate_limit` | Удалённый доступ | Debian 13.3, Ubuntu Server 24.03 | Ослабляет параметры защиты SSH (MaxAuthTries=100, LoginGraceTime=120) | sshd -T \| egrep -i 'maxauthtries\|logingracetime' |
| `linux.firewall.disabled` | Сетевой периметр и firewall | Debian 13.3, Ubuntu Server 24.03 | Отключает ufw/firewalld, где это применимо | ufw status; systemctl status ufw firewalld |
| `linux.services.insecure_telnet` | Сервисы и сетевые протоколы | Debian 13.3, Ubuntu Server 24.03 | Ставит и пытается запустить telnetd (без шифрования) | ss -lntp \| grep ':23' (если сервис поднялся) |
| `linux.services.insecure_ftp` | Сервисы и сетевые протоколы | Debian 13.3, Ubuntu Server 24.03 | Ставит `vsftpd` и включает небезопасные настройки (anonymous + запись) | ss -lntp \| grep ':21'; grep -E 'anonymous_enable\|write_enable' /etc/vsftpd.conf |
| `linux.files.world_writable_secrets` | Права на файлы и ресурсы | Debian 13.3, Ubuntu Server 24.03 | Создаёт каталог/файл “секретов” с правами `0777` | stat -c '%a %n' /opt/secret /opt/secret/credentials.txt |
| `linux.files.unsafe_path_in_profile` | Права на файлы и ресурсы | Debian 13.3, Ubuntu Server 24.03 | Добавляет `/tmp` в начало `PATH` через `/etc/profile.d` (подмена бинарников) | cat /etc/profile.d/training-unsafe-path.sh; echo $PATH |
| `linux.updates.disabled` | Обновления и управление патчами | Debian 13.3, Ubuntu Server 24.03 | Отключает авто‑обновления, где это применимо | Debian/Ubuntu: apt-daily*.timer; RHEL: dnf-automatic.timer / yum-cron |
| `linux.logging.disabled` | Логирование и аудит | Debian 13.3, Ubuntu Server 24.03 | Отключает rsyslog/auditd (и journald на RHEL, где это применимо) | systemctl status rsyslog auditd systemd-journald |
| `linux.cron.world_writable_cron` | Аутентификация и парольные политики | Debian 13.3, Ubuntu Server 24.03 | Создаёт cron-файл и скрипт, доступные на запись всем пользователям | stat -c '%a %n' /etc/cron.d/training-insecure /tmp/backup.sh |

### Примечания

- Некоторые пункты помечены как **где это применимо**: задача не падает, даже если конкретный пакет/сервис отсутствует в дистрибутиве.

---

## Windows (роль `vuln_windows`)

### Таблица

| ID | Категория | Поддержка | Что делает | Как проверить |
|---|---:|---|---|---|
| `windows.auth.weak_admin_password` | Аутентификация и парольные политики | Windows 10/11, Server 2016+ | Ставит слабый пароль для `Administrator` | Выполните `net user Administrator`, затем проверьте вход под `Administrator` с учебным паролем. |
| `windows.auth.lockout_disabled` | Аутентификация и парольные политики | Windows 10/11, Server 2016+ | Отключает политику блокировки при переборе паролей | Выполните `net accounts`: параметр `Lockout threshold` должен быть `0`. |
| `windows.auth.no_password_policy` | Аутентификация и парольные политики | Windows 10/11, Server 2016+ | Ослабляет password policy через `net accounts` | Выполните `net accounts`: ищите `Minimum password length = 0`, `Password history length = 0`, `Maximum password age = Unlimited`. |
| `windows.auth.guest_enabled` | Аутентификация и парольные политики | Windows 10/11, Server 2016+ | Включает учетную запись `Guest` | Выполните `net user Guest`: должно быть `Account active               Yes`. |
| `windows.priv.testadmin_in_admins` | Привилегии и контроль доступа | Windows 10/11, Server 2016+ | Создаёт лишнюю учётку и добавляет в `Administrators` | Выполните `net user testadmin` и `net localgroup Administrators`: пользователь должен быть в группе администраторов. |
| `windows.remote.rdp_enabled` | Удалённый доступ | Windows 10/11, Server 2016+ | Включает RDP и правила брандмауэра, где это применимо | Выполните `reg query "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server" /v fDenyTSConnections` (должно быть `0`) и `Test-NetConnection localhost -Port 3389` (порт открыт). |
| `windows.firewall.disabled` | Сетевой периметр и firewall | Windows 10/11, Server 2016+ | Отключает Windows Firewall (Domain/Public/Private) | Выполните `Get-NetFirewallProfile | Select Name, Enabled`: для всех профилей `Enabled` должен быть `False`. |
| `windows.updates.disabled` | Обновления и управление патчами | Windows 10/11, Server 2016+ | Отключает службы Windows Update, где это применимо | Выполните `Get-Service wuauserv, usosvc, WaaSMedicSvc | Select Name, Status, StartType`: службы остановлены и/или отключены. |
| `windows.defender.disabled` | Антивирус и базовые средства защиты | Windows 10/11, Server 2016+ | Отключает защиту Defender в реальном времени и пытается остановить службу, где это применимо | Выполните `Get-MpPreference | Select DisableRealtimeMonitoring` (должно быть `True`) и `Get-Service WinDefend`. |
| `windows.network.smb1_enabled` | Сервисы и сетевые протоколы | Windows 10/11, Server 2016+ | Включает SMBv1, где это применимо | Выполните `Get-WindowsOptionalFeature -Online -FeatureName SMB1Protocol | Select State`: состояние `Enabled`. |
| `windows.network.ntlmv1_enabled` | Сервисы и сетевые протоколы | Windows 10/11, Server 2016+ | Ослабляет NTLM/LM (LmCompatibilityLevel=0) | Выполните `Get-ItemProperty "HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa" -Name LmCompatibilityLevel`: значение `0` или `1`. |
| `windows.network.llmnr_enabled` | Сервисы и сетевые протоколы | Windows 10/11, Server 2016+ | Включает LLMNR (в доменной среде повышает риск подмены и ретрансляции) | Выполните `Get-ItemProperty "HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\DNSClient" -Name EnableMulticast`: значение `1` (или отсутствие политики, если не задана). |
| `windows.network.smb_signing_disabled` | Сервисы и сетевые протоколы | Windows 10/11, Server 2016+ | Отключает подписание SMB (повышает риск ретрансляции и атаки посредника) | Выполните `Get-ItemProperty "HKLM:\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters" -Name RequireSecuritySignature, EnableSecuritySignature` и аналогично для `LanmanWorkstation`: ищите отключенные требования подписи. |
| `windows.audit.disabled` | Логирование и аудит | Windows 10/11, Server 2016+ | Отключает аудит событий, где это применимо | Выполните `auditpol /get /category:*`: ключевые категории должны быть `No Auditing`. |
| `windows.services.remote_registry_enabled` | Сервисы и сетевые протоколы | Windows 10/11, Server 2016+ | Включает RemoteRegistry (лишняя поверхность) | Выполните `Get-Service RemoteRegistry | Select Status, StartType`: сервис запущен или включен в автозапуск. |
| `windows.uac.disabled` | Привилегии и контроль доступа | Windows 10/11, Server 2016+ | Отключает UAC (EnableLUA=0) | Выполните `Get-ItemProperty "HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System" -Name EnableLUA`: значение `0`. |
| `windows.desktop.no_lock_on_idle` | Привилегии и контроль доступа | Windows 10/11, Server 2016+ | Отключает блокировку/пароль по бездействию (policy-level) | Проверьте ключи в `HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\Control Panel\\Desktop`: `ScreenSaveActive`, `ScreenSaverIsSecure`, `ScreenSaveTimeOut`. |
| `windows.power.sleep_disabled` | Привилегии и контроль доступа | Windows 10/11, Server 2016+ | Отключает sleep/hibernate таймауты (Never) | Выполните `powercfg /query`: таймауты сна/гибернации должны быть `0` (Never). |

---

## Active Directory / Domain Controller (роль `vuln_ad`)

| ID | Категория | Поддержка | Что делает | Как проверить |
|---|---:|---|---|---|
| `ad.priv.user_in_domain_admins` | Привилегии и контроль доступа | DC (AD DS) | Создаёт тестового доменного пользователя и добавляет в `Domain Admins`, где это применимо | Get-ADGroupMember "Domain Admins" |
| `ad.auth.asrep_roastable_user` | Аутентификация и парольные политики | DC (AD DS) | Создаёт пользователя с `DoesNotRequirePreAuth` (уязвимого к AS-REP), где это применимо | Get-ADUser <user> -Properties DoesNotRequirePreAuth |
| `ad.network.ldap_signing_disabled` | Сервисы и сетевые протоколы | DC (где это применимо) | Отключает требование подписи LDAP (LDAPServerIntegrity=0) | Get-ItemProperty HKLM:\\SYSTEM\\CurrentControlSet\\Services\\NTDS\\Parameters |
| `ad.gpo.password_policy_weak` | Аутентификация и парольные политики | DC (где это применимо) | Делает доменную политику паролей слабой (minlen=0, complexity off, history=0, maxage=unlimited) | Get-ADDefaultDomainPasswordPolicy |
| `ad.gpo.account_lockout_disabled` | Аутентификация и парольные политики | DC (где это применимо) | Отключает доменную блокировку при переборе (threshold=0) | Get-ADDefaultDomainPasswordPolicy |
| `ad.gpo.llmnr_enabled` | Сервисы и сетевые протоколы | DC + GPO (где это применимо) | Включает LLMNR через GPO на учебную OU | Get-GPRegistryValue/реестр политики DNSClient (EnableMulticast=1) |
| `ad.gpo.smb_signing_disabled` | Сервисы и сетевые протоколы | DC + GPO (где это применимо) | Отключает подписание SMB через GPO (Server/Workstation) | проверка параметров LanmanServer/LanmanWorkstation |
| `ad.gpo.ntlmv1_allowed` | Сервисы и сетевые протоколы | DC + GPO (где это применимо) | Разрешает слабый NTLM/LM (LmCompatibilityLevel=0) через GPO | Get-ItemProperty HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa |
| `ad.gpo.firewall_disabled` | Сетевой периметр и firewall | DC + GPO (где это применимо) | Выключает Windows Firewall (Domain/Public/Private) через GPO | Get-NetFirewallProfile |
| `ad.gpo.defender_disabled` | Антивирус и базовые средства защиты | DC + GPO (где это применимо) | Пытается отключить Defender через политики | Get-MpPreference/policy keys |
| `ad.gpo.updates_disabled` | Обновления и управление патчами | DC + GPO (где это применимо) | Выключает авто‑обновления Windows через GPO (NoAutoUpdate=1) | policy key ...\\WindowsUpdate\\AU |
| `ad.gpo.powershell_logging_disabled` | Логирование и аудит | DC + GPO (где это применимо) | Выключает журналирование PowerShell (ScriptBlock/Module/Transcription) через GPO | policy keys ...\\PowerShell\\*Logging |
| `ad.gpo.audit_disabled` | Логирование и аудит | DC (где это применимо) | Выключает аудит на DC (локально) | auditpol /get /category:* |
| `ad.gpo.eventlog_retention_low` | Логирование и аудит | DC + GPO (где это применимо) | Делает журналы маленькими (быстро перезаписываются) через GPO | policy keys ...\\EventLog\\* |
| `ad.gpo.rdp_open_to_all` | Удалённый доступ | DC + GPO (где это применимо) | Включает RDP через GPO | policy key fDenyTSConnections=0 |
| `ad.gpo.winrm_insecure` | Удалённый доступ | DC + GPO (где это применимо) | Включает небезопасные настройки WinRM (AllowUnencrypted+Basic) | policy keys ...\\WinRM\\Service* |
| `ad.gpo.no_lock_on_idle` | Привилегии и контроль доступа | DC + GPO (где это применимо) | Отключает автоматическую блокировку и пароль при простое через политики screen saver | policy keys ...\\Control Panel\\Desktop |

---

## Как расширять каталог под вашу классификацию (1..9)

Каталог можно расширять двумя шагами:

1) **Добавить реализацию** в роли (новый `tasks/vulns/<id>.yml` + регистрация в `*_known`).
2) **Добавить строку в таблицу** этого файла: ID → категория → поддержка → проверка → эффект.

