# Каталог уязвимостей (Ansible)

Документ описывает **уязвимости как модули**: каждая уязвимость имеет **ID**, относится к одной из категорий \(1..10\), имеет уровень сложности, и понятную проверку “как увидеть, что уязвимость включена”.

Источник применения:
- Linux: роль `ansible/roles/vkr_vuln_linux`
- Windows: роль `ansible/roles/vkr_vuln_windows`

Включение/выключение делается списками ID в:
- `stands/<scenario>/infrastructure/ansible/group_vars/all/vulnerabilities.yml` → `vuln_profiles.*`

## Легенда

- **Категория**: номер раздела из вашей классификации \(1..10\)
- **Уровень**: `beginner | intermediate | advanced`
- **Эффект**: что именно ослабляется/ломается для обучения

---

## Linux (роль `vkr_vuln_linux`)

### Таблица

| ID | Категория | Уровень | Поддержка | Что делает | Как проверить |
|---|---:|---|---|---|---|
| `linux.auth.weak_root_password` | 1 | beginner | debian-family, rhel-family | Ставит слабый пароль для `root` | Попробовать SSH/консоль вход под `root` по паролю; `sudo grep '^root:' /etc/shadow` |
| `linux.auth.no_password_policy` | 1 | intermediate | debian-family, rhel-family | Ослабляет требования к паролям (pwquality/PAM, best-effort) | Debian/Ubuntu: `/etc/security/pwquality.conf`, `/etc/pam.d/common-password`; RHEL: `/etc/pam.d/password-auth`, `/etc/pam.d/system-auth` |
| `linux.auth.extra_admin_user` | 2 | beginner | debian-family, rhel-family | Создаёт лишнюю privileged‑учётку в `sudo` | `getent group sudo | grep -i testadmin` |
| `linux.sudo.nopasswd` | 2 | beginner | debian-family, rhel-family | Делает `sudo` без пароля для группы `sudo` | `sudo -l` (видно `NOPASSWD:ALL`) |
| `linux.ssh.root_login` | 3 | beginner | debian-family, rhel-family | Разрешает SSH‑вход для `root` | `sshd -T \| grep -i permitrootlogin` |
| `linux.ssh.password_auth` | 3 | beginner | debian-family, rhel-family | Включает парольную SSH‑аутентификацию | `sshd -T \| grep -i passwordauthentication` |
| `linux.firewall.disabled` | 7 | beginner | debian-family, rhel-family | Отключает ufw/firewalld (best-effort) | `ufw status`; `systemctl status ufw firewalld` |
| `linux.services.insecure_telnet` | 6 | intermediate | debian-family, rhel-family | Ставит и пытается запустить telnetd (без шифрования) | `ss -lntp \| grep ':23'` (если сервис поднялся) |
| `linux.services.insecure_ftp` | 6 | intermediate | debian-family, rhel-family | Ставит `vsftpd` и включает insecure настройки (anon+write) | `ss -lntp \| grep ':21'`; `grep -E 'anonymous_enable|write_enable' /etc/vsftpd.conf` |
| `linux.files.world_writable_secrets` | 4 | beginner | debian-family, rhel-family | Создаёт каталог/файл “секретов” с правами `0777` | `stat -c '%a %n' /opt/secret /opt/secret/credentials.txt` |
| `linux.updates.disabled` | 5 | intermediate | debian-family, rhel-family | Отключает авто‑обновления (best-effort) | Debian/Ubuntu: `apt-daily*.timer`; RHEL: `dnf-automatic.timer` / `yum-cron` |
| `linux.logging.disabled` | 8 | intermediate | debian-family, rhel-family (best-effort) | Отключает rsyslog/auditd (+ journald на RHEL, best-effort) | `systemctl status rsyslog auditd systemd-journald` |
| `linux.cron.world_writable_cron` | 1 | advanced | debian-family, rhel-family | Создаёт world‑writable cron‑файл и world‑writable скрипт в `/tmp` | `stat -c '%a %n' /etc/cron.d/vkr-insecure /tmp/backup.sh` |

### Примечания

- Некоторые пункты помечены как **best-effort**: они не падают, даже если конкретный пакет/сервис отсутствует в дистрибутиве.

---

## Windows (роль `vkr_vuln_windows`)

### Таблица

| ID | Категория | Уровень | Поддержка | Что делает | Как проверить |
|---|---:|---|---|---|---|
| `windows.auth.weak_admin_password` | 1 | beginner | Windows 10/11, Server 2016+ | Ставит слабый пароль для `Administrator` | `net user Administrator` (пароль напрямую не покажет, проверка — вход/подбор) |
| `windows.auth.no_password_policy` | 1 | beginner | Windows 10/11, Server 2016+ | Ослабляет password policy через `net accounts` | `net accounts` |
| `windows.auth.guest_enabled` | 1 | beginner | Windows 10/11, Server 2016+ | Включает учетную запись `Guest` | `net user guest` (Active) |
| `windows.priv.testadmin_in_admins` | 2 | beginner | Windows 10/11, Server 2016+ | Создаёт лишнюю учётку и добавляет в `Administrators` | `net localgroup Administrators` |
| `windows.remote.rdp_enabled` | 3 | beginner | Windows 10/11, Server 2016+ | Включает RDP + включает правила FW (best-effort) | Проверка реестра `fDenyTSConnections=0`, порт `3389` слушает |
| `windows.firewall.disabled` | 7 | beginner | Windows 10/11, Server 2016+ | Отключает Windows Firewall (Domain/Public/Private) | `Get-NetFirewallProfile` |
| `windows.updates.disabled` | 5 | intermediate | Windows 10/11, Server 2016+ | Отключает Windows Update сервисы (best-effort) | `Get-Service wuauserv,usosvc,WaaSMedicSvc` |
| `windows.defender.disabled` | 10 | intermediate | Windows 10/11 (Server: best-effort) | Отключает Defender realtime и пытается остановить сервис (best-effort) | `Get-MpPreference`; `Get-Service WinDefend` |
| `windows.network.smb1_enabled` | 6 | intermediate | Windows 10/11, Server 2016+ | Включает SMBv1 (best-effort) | `Get-WindowsOptionalFeature -Online -FeatureName SMB1Protocol` (или фича на сервере) |
| `windows.network.ntlmv1_enabled` | 6 | intermediate | Windows 10/11, Server 2016+ | Ослабляет NTLM/LM (LmCompatibilityLevel=0) | `Get-ItemProperty HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa` |
| `windows.audit.disabled` | 8 | intermediate | Windows 10/11, Server 2016+ | Отключает auditpol (best-effort) | `auditpol /get /category:*` |

---

## Как расширять каталог под вашу классификацию (1..10)

Каталог можно расширять двумя шагами:

1) **Добавить реализацию** в роли (новый `tasks/vulns/<id>.yml` + регистрация в `*_known`).
2) **Добавить строку в таблицу** этого файла: ID → категория → уровень → проверка → эффект.

