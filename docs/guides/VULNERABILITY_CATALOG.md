# Каталог уязвимостей (Ansible)

Документ описывает **уязвимости как модули**: каждая уязвимость имеет **ID**, относится к одной из категорий \(1..9\), имеет уровень сложности, и понятную проверку “как увидеть, что уязвимость включена”.

Источник применения:
- Linux: роль `ansible/roles/vuln_linux`
- Windows: роль `ansible/roles/vuln_windows`

Включение/выключение делается списками ID в:
- `stands/<scenario>/infrastructure/ansible/group_vars/all/vulnerabilities.yml` → `vuln_profiles.*`

## Легенда

- **Категория**: номер раздела из вашей классификации \(1..9\)
- **Уровень**: `beginner | intermediate | advanced`
- **Эффект**: что именно ослабляется/ломается для обучения

---

## Linux (роль `vuln_linux`)

### Таблица

| ID | Категория | Уровень | Поддержка | Что делает | Как проверить |
|---|---:|---|---|---|---|
| `linux.auth.weak_root_password` | 1 | beginner | debian-family, rhel-family | Ставит слабый пароль для `root` | Попробовать SSH/консоль вход под `root` по паролю; `sudo grep '^root:' /etc/shadow` |
| `linux.auth.lockout_disabled` | 1 | intermediate | debian-family, rhel-family (best-effort) | Отключает/ослабляет механизмы lockout/ban (fail2ban/pam_faillock), облегчая перебор | `systemctl status fail2ban` (stopped/disabled); поиск `pam_faillock` в `/etc/pam.d/*` |
| `linux.auth.no_password_policy` | 1 | intermediate | debian-family, rhel-family | Ослабляет требования к паролям (pwquality/PAM, best-effort) | Debian/Ubuntu: `/etc/security/pwquality.conf`, `/etc/pam.d/common-password`; RHEL: `/etc/pam.d/password-auth`, `/etc/pam.d/system-auth` |
| `linux.auth.extra_admin_user` | 2 | beginner | debian-family, rhel-family | Создаёт лишнюю privileged‑учётку в `sudo` | `getent group sudo | grep -i testadmin` |
| `linux.sudo.nopasswd` | 2 | beginner | debian-family, rhel-family | Делает `sudo` без пароля для группы `sudo` | `sudo -l` (видно `NOPASSWD:ALL`) |
| `linux.priv.suid_bash_backdoor` | 2 | advanced | debian-family, rhel-family | Кладёт SUID-root bash `/usr/local/bin/vkrbash` (локальная эскалация) | `ls -l /usr/local/bin/vkrbash` (бит `s`); `"/usr/local/bin/vkrbash -p -c id"` |
| `linux.ssh.root_login` | 3 | beginner | debian-family, rhel-family | Разрешает SSH‑вход для `root` | `sshd -T \| grep -i permitrootlogin` |
| `linux.ssh.password_auth` | 3 | beginner | debian-family, rhel-family | Включает парольную SSH‑аутентификацию | `sshd -T \| grep -i passwordauthentication` |
| `linux.ssh.no_rate_limit` | 3 | intermediate | debian-family, rhel-family | Ослабляет параметры защиты SSH (MaxAuthTries=100, LoginGraceTime=120) | `sshd -T \| egrep -i 'maxauthtries|logingracetime'` |
| `linux.firewall.disabled` | 7 | beginner | debian-family, rhel-family | Отключает ufw/firewalld (best-effort) | `ufw status`; `systemctl status ufw firewalld` |
| `linux.services.insecure_telnet` | 6 | intermediate | debian-family, rhel-family | Ставит и пытается запустить telnetd (без шифрования) | `ss -lntp \| grep ':23'` (если сервис поднялся) |
| `linux.services.insecure_ftp` | 6 | intermediate | debian-family, rhel-family | Ставит `vsftpd` и включает insecure настройки (anon+write) | `ss -lntp \| grep ':21'`; `grep -E 'anonymous_enable|write_enable' /etc/vsftpd.conf` |
| `linux.files.world_writable_secrets` | 4 | beginner | debian-family, rhel-family | Создаёт каталог/файл “секретов” с правами `0777` | `stat -c '%a %n' /opt/secret /opt/secret/credentials.txt` |
| `linux.files.unsafe_path_in_profile` | 4 | intermediate | debian-family, rhel-family | Добавляет `/tmp` в начало `PATH` через `/etc/profile.d` (подмена бинарников) | `cat /etc/profile.d/vkr-unsafe-path.sh`; `echo $PATH` |
| `linux.updates.disabled` | 5 | intermediate | debian-family, rhel-family | Отключает авто‑обновления (best-effort) | Debian/Ubuntu: `apt-daily*.timer`; RHEL: `dnf-automatic.timer` / `yum-cron` |
| `linux.logging.disabled` | 8 | intermediate | debian-family, rhel-family (best-effort) | Отключает rsyslog/auditd (+ journald на RHEL, best-effort) | `systemctl status rsyslog auditd systemd-journald` |
| `linux.cron.world_writable_cron` | 1 | advanced | debian-family, rhel-family | Создаёт world‑writable cron‑файл и world‑writable скрипт в `/tmp` | `stat -c '%a %n' /etc/cron.d/vkr-insecure /tmp/backup.sh` |

### Примечания

- Некоторые пункты помечены как **best-effort**: они не падают, даже если конкретный пакет/сервис отсутствует в дистрибутиве.

---

## Windows (роль `vuln_windows`)

### Таблица

| ID | Категория | Уровень | Поддержка | Что делает | Как проверить |
|---|---:|---|---|---|---|
| `windows.auth.weak_admin_password` | 1 | beginner | Windows 10/11, Server 2016+ | Ставит слабый пароль для `Administrator` | `net user Administrator` (пароль напрямую не покажет, проверка — вход/подбор) |
| `windows.auth.lockout_disabled` | 1 | intermediate | Windows 10/11, Server 2016+ | Отключает lockout policy (облегчает перебор) | `net accounts` (Lockout threshold = 0) |
| `windows.auth.no_password_policy` | 1 | beginner | Windows 10/11, Server 2016+ | Ослабляет password policy через `net accounts` | `net accounts` |
| `windows.auth.guest_enabled` | 1 | beginner | Windows 10/11, Server 2016+ | Включает учетную запись `Guest` | `net user guest` (Active) |
| `windows.priv.testadmin_in_admins` | 2 | beginner | Windows 10/11, Server 2016+ | Создаёт лишнюю учётку и добавляет в `Administrators` | `net localgroup Administrators` |
| `windows.remote.rdp_enabled` | 3 | beginner | Windows 10/11, Server 2016+ | Включает RDP + включает правила FW (best-effort) | Проверка реестра `fDenyTSConnections=0`, порт `3389` слушает |
| `windows.firewall.disabled` | 7 | beginner | Windows 10/11, Server 2016+ | Отключает Windows Firewall (Domain/Public/Private) | `Get-NetFirewallProfile` |
| `windows.updates.disabled` | 5 | intermediate | Windows 10/11, Server 2016+ | Отключает Windows Update сервисы (best-effort) | `Get-Service wuauserv,usosvc,WaaSMedicSvc` |
| `windows.defender.disabled` | 9 | intermediate | Windows 10/11 (Server: best-effort) | Отключает Defender realtime и пытается остановить сервис (best-effort) | `Get-MpPreference`; `Get-Service WinDefend` |
| `windows.network.smb1_enabled` | 6 | intermediate | Windows 10/11, Server 2016+ | Включает SMBv1 (best-effort) | `Get-WindowsOptionalFeature -Online -FeatureName SMB1Protocol` (или фича на сервере) |
| `windows.network.ntlmv1_enabled` | 6 | intermediate | Windows 10/11, Server 2016+ | Ослабляет NTLM/LM (LmCompatibilityLevel=0) | `Get-ItemProperty HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa` |
| `windows.network.llmnr_enabled` | 6 | intermediate | Windows 10/11, Server 2016+ | Включает LLMNR (возможны spoofing/relay в доменной среде) | `Get-ItemProperty HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\DNSClient` |
| `windows.network.smb_signing_disabled` | 6 | advanced | Windows 10/11, Server 2016+ | Отключает SMB signing (повышает риск relay/MITM) | `Get-ItemProperty HKLM:\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters` и `...LanmanWorkstation...` |
| `windows.audit.disabled` | 8 | intermediate | Windows 10/11, Server 2016+ | Отключает auditpol (best-effort) | `auditpol /get /category:*` |
| `windows.services.remote_registry_enabled` | 6 | beginner | Windows 10/11, Server 2016+ | Включает RemoteRegistry (лишняя поверхность) | `Get-Service RemoteRegistry` |
| `windows.uac.disabled` | 2 | intermediate | Windows 10/11, Server 2016+ | Отключает UAC (EnableLUA=0) | `Get-ItemProperty HKLM:\\...\\Policies\\System` (EnableLUA=0) |
| `windows.desktop.no_lock_on_idle` | 2 | beginner | Windows 10/11, Server 2016+ | Отключает блокировку/пароль по бездействию (policy-level) | ключи `HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\Control Panel\\Desktop` |
| `windows.power.sleep_disabled` | 2 | beginner | Windows 10/11, Server 2016+ | Отключает sleep/hibernate таймауты (Never) | `powercfg /query` / проверка текущих таймаутов |

---

## Active Directory / Domain Controller (роль `vuln_ad`)

| ID | Категория | Уровень | Поддержка | Что делает | Как проверить |
|---|---:|---|---|---|---|
| `ad.priv.user_in_domain_admins` | 2 | intermediate | DC (AD DS) | Создаёт тестового доменного пользователя и добавляет в `Domain Admins` (best-effort) | `Get-ADGroupMember "Domain Admins"` |
| `ad.auth.asrep_roastable_user` | 1 | advanced | DC (AD DS) | Создаёт пользователя с `DoesNotRequirePreAuth` (AS-REP roast) (best-effort) | `Get-ADUser <user> -Properties DoesNotRequirePreAuth` |
| `ad.network.ldap_signing_disabled` | 6 | advanced | DC (best-effort) | Отключает требование LDAP signing (LDAPServerIntegrity=0) | `Get-ItemProperty HKLM:\\SYSTEM\\CurrentControlSet\\Services\\NTDS\\Parameters` |
| `ad.gpo.password_policy_weak` | 1 | beginner | DC (best-effort) | Делает доменную password policy слабой (minlen=0, complexity off, history=0, maxage=unlimited) | `Get-ADDefaultDomainPasswordPolicy` |
| `ad.gpo.account_lockout_disabled` | 1 | beginner | DC (best-effort) | Отключает доменный lockout (threshold=0) | `Get-ADDefaultDomainPasswordPolicy` |
| `ad.gpo.llmnr_enabled` | 6 | intermediate | DC + GPO (best-effort) | Включает LLMNR через GPO на OU Training | `Get-GPRegistryValue`/реестр политики DNSClient (EnableMulticast=1) |
| `ad.gpo.smb_signing_disabled` | 6 | advanced | DC + GPO (best-effort) | Отключает SMB signing через GPO (Server/Workstation) | проверка параметров LanmanServer/LanmanWorkstation |
| `ad.gpo.ntlmv1_allowed` | 6 | intermediate | DC + GPO (best-effort) | Разрешает слабый NTLM/LM (LmCompatibilityLevel=0) через GPO | `Get-ItemProperty HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa` |
| `ad.gpo.firewall_disabled` | 7 | beginner | DC + GPO (best-effort) | Выключает Windows Firewall (Domain/Public/Private) через GPO | `Get-NetFirewallProfile` |
| `ad.gpo.defender_disabled` | 9 | intermediate | DC + GPO (best-effort) | Пытается отключить Defender через политики | `Get-MpPreference`/policy keys |
| `ad.gpo.updates_disabled` | 5 | intermediate | DC + GPO (best-effort) | Выключает авто‑обновления Windows через GPO (NoAutoUpdate=1) | policy key `...\\WindowsUpdate\\AU` |
| `ad.gpo.powershell_logging_disabled` | 8 | intermediate | DC + GPO (best-effort) | Выключает PowerShell ScriptBlock/Module/Transcription logging через GPO | policy keys `...\\PowerShell\\*Logging` |
| `ad.gpo.audit_disabled` | 8 | intermediate | DC (best-effort) | Выключает auditpol на DC (локально) | `auditpol /get /category:*` |
| `ad.gpo.eventlog_retention_low` | 8 | intermediate | DC + GPO (best-effort) | Делает маленькие журналы (быстро перезатираются) через GPO | policy keys `...\\EventLog\\*` |
| `ad.gpo.rdp_open_to_all` | 3 | beginner | DC + GPO (best-effort) | Включает RDP через GPO | policy key `fDenyTSConnections=0` |
| `ad.gpo.winrm_insecure` | 3 | advanced | DC + GPO (best-effort) | Включает небезопасные настройки WinRM (AllowUnencrypted+Basic) | policy keys `...\\WinRM\\Service*` |
| `ad.gpo.no_lock_on_idle` | 2 | beginner | DC + GPO (best-effort) | Отключает auto-lock / пароль при простое через политики screen saver | policy keys `...\\Control Panel\\Desktop` |

---

## Как расширять каталог под вашу классификацию (1..9)

Каталог можно расширять двумя шагами:

1) **Добавить реализацию** в роли (новый `tasks/vulns/<id>.yml` + регистрация в `*_known`).
2) **Добавить строку в таблицу** этого файла: ID → категория → уровень → проверка → эффект.

