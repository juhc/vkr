# Сценарий: Небольшая ISP компания

## Обзор организации

**Название**: ООО "ИнтернетПлюс"  
**Тип**: Небольшой интернет-провайдер, предоставляющий услуги доступа в интернет  
**Количество сотрудников**: 15-20 человек  
**Количество клиентов**: ~5000 абонентов  
**Сфера деятельности**: Предоставление интернет-услуг, хостинг, доменные имена

## Организационная структура

### Департаменты и роли

#### 1. Руководство
- **Директор** (1 чел.)
  - Учетная запись: `director@internetplus.local`
  - Привилегии: Полный доступ ко всем системам
  - Типичные ошибки: Использование простых паролей, доступ к критичным системам с личных устройств

#### 2. Технический отдел (8 человек)
- **Главный инженер** (1 чел.)
  - Учетная запись: `engineer@internetplus.local`
  - Рабочая станция: Windows 10 Pro
  - Привилегии: Полный доступ к серверам и инфраструктуре
  - Типичные ошибки: Слабые пароли, RDP доступ из интернета, необновленное ПО

- **Системные администраторы** (3 чел.)
  - Учетные записи: `admin1@internetplus.local`, `admin2@internetplus.local`, `admin3@internetplus.local`
  - Рабочие станции: Windows 10 Pro
  - Привилегии: Административные права на серверах
  - Типичные ошибки: Открытые RDP/SSH порты, слабые пароли, необновленное ПО, учетные данные в открытом виде

- **Сетевые инженеры** (2 чел.)
  - Учетные записи: `network1@internetplus.local`, `network2@internetplus.local`
  - Рабочие станции: Windows 10 Pro
  - Привилегии: Доступ к серверам и системам мониторинга
  - Типичные ошибки: Слабые пароли, необновленное ПО, открытые сетевые порты

- **Техническая поддержка** (2 чел.)
  - Учетные записи: `support1@internetplus.local`, `support2@internetplus.local`
  - Рабочие станции: Windows 10 Home/Pro
  - Привилегии: Доступ к системам мониторинга и CRM
  - Типичные ошибки: Доступ к чувствительным данным клиентов, слабые пароли, необновленное ПО

#### 3. Отдел продаж и обслуживания клиентов (5 человек)
- **Менеджеры по продажам** (3 чел.)
  - Учетные записи: `sales1@internetplus.local`, `sales2@internetplus.local`, `sales3@internetplus.local`
  - Рабочие станции: Windows 10 Home/Pro
  - Привилегии: Доступ к CRM системе, ограниченный доступ к биллингу
  - Типичные ошибки: Хранение паролей в открытом виде, доступ к данным других менеджеров, необновленное ПО

- **Менеджеры по работе с клиентами** (2 чел.)
  - Учетные записи: `client1@internetplus.local`, `client2@internetplus.local`
  - Рабочие станции: Windows 10 Home/Pro
  - Привилегии: Доступ к CRM и системам поддержки
  - Типичные ошибки: Утечка данных клиентов, небезопасная передача информации, слабые пароли

#### 4. Бухгалтерия (2 человека)
- **Главный бухгалтер** (1 чел.)
  - Учетная запись: `accountant@internetplus.local`
  - Рабочая станция: Windows 10 Pro
  - Привилегии: Доступ к финансовым системам, биллингу
  - Типичные ошибки: Доступ к финансовым данным с небезопасных устройств, слабые пароли, необновленное ПО

- **Бухгалтер** (1 чел.)
  - Учетная запись: `accountant2@internetplus.local`
  - Рабочая станция: Windows 10 Home/Pro
  - Привилегии: Ограниченный доступ к финансовым системам
  - Типичные ошибки: Слабые пароли, отсутствие двухфакторной аутентификации, необновленное ПО

#### 5. Отдел маркетинга (2 человека)
- **Маркетолог** (1 чел.)
  - Учетная запись: `marketing@internetplus.local`
  - Рабочая станция: Windows 10 Home/Pro
  - Привилегии: Доступ к веб-сайту и системам аналитики
  - Типичные ошибки: Небезопасная конфигурация веб-сайта, слабые пароли

- **Веб-мастер** (1 чел.)
  - Учетная запись: `webmaster@internetplus.local`
  - Рабочая станция: Windows 10 Pro
  - Привилегии: Доступ к веб-серверам и CMS
  - Типичные ошибки: Уязвимые версии CMS, слабые пароли администраторов, необновленное ПО

## Структура сети

### Сетевая топология

```
                    Internet (Upstream)
                          |
                  [Firewall/Gateway]
                          |
        +-----------------+-----------------+-----------------+
        |                 |                 |                 |
    [Infrastructure]    [Services]       [Management]      [Attacker]
        Network          Network          Network          Network
  (192.168.10.0/24) (192.168.20.0/24) (192.168.30.0/24) (192.168.50.0/24)
        |                 |                 |                 |
    +---+---+         +---+---+         +---+---+         +---+---+
    |       |         |       |         |       |         |       |
  RADIUS          Billing  Web      Monitoring  Jump      Kali Linux
  Server          Server Server     Server      Server    Pentest Box
```

### Сетевые сегменты

Сценарий упрощен для удобства обучения и содержит только **5 ключевых машин инфраструктуры**:

#### 1. Инфраструктурная сеть (Infrastructure Network) - 192.168.10.0/24
**Назначение**: Критичные сервисы для работы провайдера  
**Изоляция**: Изолирована от публичного доступа

**Устройства**:
- **RADIUS сервер** (192.168.10.10)
  - ОС: Ubuntu 20.04 LTS
  - Роль: Аутентификация клиентов провайдера
  - Сервисы: FreeRADIUS, MySQL backend
  - Уязвимости: Слабый пароль базы данных, небезопасная конфигурация, утечка данных клиентов

#### 2. Сервисная сеть (Services Network) - 192.168.20.0/24
**Назначение**: Публичные сервисы для клиентов  
**Изоляция**: Частично изолирована, доступна из интернета

**Устройства**:
- **Биллинговый сервер** (192.168.20.10)
  - ОС: Ubuntu 20.04 LTS
  - Роль: Управление счетами и платежами клиентов
  - Сервисы: Apache, PHP приложение, PostgreSQL
  - Уязвимости: Слабые пароли БД, SQL инъекции, необновленное ПО, утечка данных клиентов

- **Веб-сервер** (192.168.20.20)
  - ОС: Ubuntu 20.04 LTS
  - Роль: Корпоративный сайт и клиентский портал
  - Сервисы: Apache, PHP, WordPress CMS
  - Уязвимости: Устаревшая версия WordPress, SQL инъекции, XSS, небезопасная конфигурация Apache

#### 3. Управляющая сеть (Management Network) - 192.168.30.0/24
**Назначение**: Управление инфраструктурой  
**Изоляция**: Полностью изолирована

**Устройства**:
- **Сервер мониторинга** (192.168.30.10)
  - ОС: Ubuntu 20.04 LTS
  - Роль: Мониторинг серверов и сервисов
  - Сервисы: Zabbix, SNMP
  - Уязвимости: Слабые SNMP community strings, открытый веб-интерфейс, слабые пароли, раскрытие информации об инфраструктуре

- **Jump-сервер** (192.168.30.20)
  - ОС: Ubuntu 20.04 LTS
  - Роль: Точка входа для администраторов
  - Сервисы: SSH, VPN
  - Уязвимости: Доступ по паролю, отсутствие 2FA, слабые пароли, отсутствие защиты от брутфорса

#### 4. Сеть атакующего (Attacker Network) - 192.168.50.0/24
**Назначение**: Машина для проведения тестирования на проникновение  
**Изоляция**: Отдельная сеть с доступом ко всем тестируемым сетям

**Устройства**:
- **Kali Linux Pentest Box** (192.168.50.10)
  - ОС: Kali Linux (последняя версия)
  - Роль: Машина атакующего для проведения пентеста
  - Сервисы: Предустановленные инструменты для тестирования на проникновение
  - Доступ: Доступ ко всем сетям инфраструктуры для тестирования
  - Инструменты: Nmap, Metasploit, Burp Suite, SQLMap, Hydra, John the Ripper, Wireshark и др.

## Типичные уязвимости и ошибки

### Уровень 1: Базовые ошибки конфигурации
1. **Слабые пароли**
   - Простые пароли для учетных записей администраторов
   - Слабые пароли баз данных (MySQL, PostgreSQL)
   - Пароли по умолчанию
   - Отсутствие политики сложности паролей

2. **Открытые порты управления**
   - SSH доступен без ограничений
   - Веб-интерфейсы управления без аутентификации
   - SNMP с публичными community strings
   - Открытые порты баз данных

3. **Необновленное ПО**
   - Устаревшие версии операционных систем
   - Непатченные уязвимости в приложениях
   - Отключенные автоматические обновления
   - Устаревшие версии CMS (WordPress)

### Уровень 2: Ошибки конфигурации безопасности
4. **Небезопасные протоколы**
   - SNMP v1/v2c (без шифрования)
   - HTTP вместо HTTPS для клиентского портала
   - Отсутствие шифрования соединений с БД

5. **Избыточные привилегии**
   - Пользователи с правами администратора без необходимости
   - Широкий доступ к данным клиентов
   - Неограниченный доступ к биллинговой системе

6. **Отсутствие мониторинга**
   - Не настроено логирование критичных событий
   - Отсутствие алертов на подозрительную активность
   - Нет системы обнаружения вторжений

### Уровень 3: Архитектурные проблемы
7. **Отсутствие сегментации сети**
   - Клиентская сеть имеет доступ к инфраструктурной
   - Отсутствие изоляции между сервисами
   - Нет разделения на production и management сети

8. **Утечки данных клиентов**
   - Данные клиентов в открытом виде в базах данных
   - Резервные копии без шифрования
   - Логи содержат пароли и персональные данные

9. **Отсутствие резервного копирования**
   - Не настроено автоматическое резервное копирование
   - Бэкапы хранятся на том же сервере
   - Нет плана восстановления после сбоев

## Сценарии для обучения

### Сценарий 1: Компрометация RADIUS сервера
**Цель**: Обнаружение и эксплуатация уязвимостей в системе аутентификации  
**Уровень**: Средний  
**Время**: 2-3 часа

### Сценарий 2: Утечка данных клиентов через биллинговую систему
**Цель**: Обнаружение и эксплуатация уязвимостей в биллинге  
**Уровень**: Средний  
**Время**: 2-3 часа

### Сценарий 3: Компрометация через веб-портал клиентов
**Цель**: Обнаружение и эксплуатация уязвимостей веб-приложения  
**Уровень**: Начальный  
**Время**: 1-2 часа

### Сценарий 4: Компрометация через сервер мониторинга
**Цель**: Обнаружение и эксплуатация уязвимостей в системе мониторинга  
**Уровень**: Средний  
**Время**: 2-3 часа

### Сценарий 5: Комплексная атака - от веб-сервера к критичным системам
**Цель**: Понимание цепочки атаки в инфраструктуре провайдера  
**Уровень**: Продвинутый  
**Время**: 4-5 часов

## Управление уязвимостями и настройками

Все уязвимости и настройки машин можно легко изменять через конфигурационный файл `infrastructure/ansible/vulnerabilities.yml`.

### Основные возможности:

- **Включение/отключение уязвимостей**: Каждая уязвимость может быть включена или отключена независимо
- **Изменение паролей**: Легко изменять пароли для различных сервисов
- **Настройка уровня сложности**: Установить уровень сложности (beginner/intermediate/advanced)
- **Гранулярное управление**: Управлять отдельными аспектами уязвимостей

### Быстрый старт:

1. **Отредактировать конфигурацию**:
   ```bash
   nano scenarios/scenario-isp-company/infrastructure/ansible/vulnerabilities.yml
   ```

2. **Использовать скрипт управления**:
   ```bash
   cd scenarios/scenario-isp-company/infrastructure/ansible/scripts
   ./manage-vulnerabilities.sh help
   ```

3. **Применить изменения**:
   ```bash
   ./manage-vulnerabilities.sh apply
   ```

Подробная документация находится в файле `infrastructure/ansible/README_VULNERABILITIES.md`.


