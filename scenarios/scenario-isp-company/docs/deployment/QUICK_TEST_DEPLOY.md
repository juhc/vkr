# –ë—ã—Å—Ç—Ä–æ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –æ–¥–Ω–æ–π –º–∞—à–∏–Ω—ã

## –ì–¥–µ –Ω–∞–π—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

### üìñ –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:

1. **`infrastructure/terraform/proxmox/FIRST_RUN.md`** - **–ù–ê–ß–ù–ò–¢–ï –û–¢–°–Æ–î–ê!**
   - –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Proxmox
   - –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–π –º–∞—à–∏–Ω—ã (RADIUS —Å–µ—Ä–≤–µ—Ä)
   - –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

2. **`infrastructure/terraform/proxmox/TESTING.md`**
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏
   - –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω
   - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ—Å—É—Ä—Å–∞–º

3. **`infrastructure/terraform/proxmox/README.md`**
   - –û–±—â–µ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –Ω–∞ Proxmox
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API —Ç–æ–∫–µ–Ω–æ–≤
   - –°–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (3 —à–∞–≥–∞)

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Proxmox

```bash
# 1. –°–æ–∑–¥–∞–π—Ç–µ API —Ç–æ–∫–µ–Ω –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Proxmox
# Datacenter ‚Üí Permissions ‚Üí API Tokens ‚Üí Add
# Token ID: terraform@pve!terraform-token
# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ Token Secret!

# 2. –°–æ–∑–¥–∞–π—Ç–µ —à–∞–±–ª–æ–Ω Ubuntu 20.04
# –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ FIRST_RUN.md, —Ä–∞–∑–¥–µ–ª "1.2 –°–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ Ubuntu"
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Terraform

```bash
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é Proxmox
cd scenarios/scenario-isp-company/infrastructure/terraform/proxmox

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp terraform.tfvars.example terraform.tfvars

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ terraform.tfvars
nano terraform.tfvars
```

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∞ –æ–¥–Ω–æ–π –º–∞—à–∏–Ω—ã:**

```hcl
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Proxmox API
proxmox_api_url          = "https://–í–ê–®_IP_PROXMOX:8006/api2/json"
proxmox_api_token_id     = "terraform@pve!terraform-token"
proxmox_api_token_secret = "–í–ê–®_–°–ï–ö–†–ï–¢_–¢–û–ö–ï–ù–ê"
proxmox_tls_insecure     = true

# –£–∑–µ–ª Proxmox
proxmox_target_node = "proxmox"  # –ò–ª–∏ –∏–º—è –≤–∞—à–µ–≥–æ —É–∑–ª–∞

# –®–∞–±–ª–æ–Ω
proxmox_template_name = "ubuntu-20.04-template"

# –•—Ä–∞–Ω–∏–ª–∏—â–µ
proxmox_disk_storage = "local-lvm"

# –°–µ—Ç—å
network_bridge  = "vmbr0"
network_gateway = "192.168.10.1"
dns_servers     = ["8.8.8.8", "8.8.4.4"]

# SSH
ssh_public_key_file = "~/.ssh/id_rsa.pub"
ssh_user            = "ubuntu"

# –í–ö–õ–Æ–ß–ò–¢–¨ –¢–û–õ–¨–ö–û –û–î–ù–£ –ú–ê–®–ò–ù–£ –î–õ–Ø –¢–ï–°–¢–ê
enable_radius_server    = true   # ‚Üê –í–∫–ª—é—á–∏—Ç—å RADIUS —Å–µ—Ä–≤–µ—Ä
enable_billing_server   = false
enable_web_server       = false
enable_monitoring_server = false
enable_jump_server      = false
enable_kali_attacker     = false

# –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –¥–ª—è —Ç–µ—Å—Ç–∞
radius_cpu     = 1
radius_memory  = 2048
radius_disk_size = "20G"
```

### –®–∞–≥ 3: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

```bash
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Terraform
terraform init

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–ª–∞–Ω–∞ (—á—Ç–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ)
terraform plan

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ (—Å–æ–∑–¥–∞–Ω–∏–µ –º–∞—à–∏–Ω—ã)
terraform apply
# –í–≤–µ–¥–∏—Ç–µ 'yes' –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
```

## –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
cd scenarios/scenario-isp-company/infrastructure/terraform/proxmox
./deploy-single-vm.sh
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –≤—ã–±—Ä–∞—Ç—å –º–∞—à–∏–Ω—É –∏–∑ –º–µ–Ω—é –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `terraform.tfvars` –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–π —Ñ–ª–∞–≥ –≤ `true`:

```hcl
# –î–ª—è RADIUS —Å–µ—Ä–≤–µ—Ä–∞:
enable_radius_server = true
enable_billing_server = false
enable_web_server = false
# ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ false
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Proxmox

–í –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Proxmox:
- **Datacenter ‚Üí local ‚Üí VMs**
- –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–∑–¥–∞–Ω–Ω–∞—è –í–ú
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ–Ω–∞ –∑–∞–ø—É—â–µ–Ω–∞

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ IP –∞–¥—Ä–µ—Å–∞

```bash
# –ß–µ—Ä–µ–∑ Terraform
terraform output vm_ips

# –ò–ª–∏ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Proxmox –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ IP –∞–¥—Ä–µ—Å –í–ú
```

### 3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –º–∞—à–∏–Ω–µ

```bash
# –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω—É—Ç—ã –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è (cloud-init)
ssh ubuntu@<IP_ADDRESS>

# –ò–ª–∏ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–ª—é—á–∞:
ssh -i ~/.ssh/id_rsa ubuntu@<IP_ADDRESS>
```

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ù–∞—á–Ω–∏—Ç–µ —Å —Å–∞–º—ã—Ö –ø—Ä–æ—Å—Ç—ã—Ö –º–∞—à–∏–Ω:

1. **RADIUS —Å–µ—Ä–≤–µ—Ä** (192.168.10.10) - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã, –ø—Ä–æ—Å—Ç–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
2. **Jump-—Å–µ—Ä–≤–µ—Ä** (192.168.30.20) - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
3. **–í–µ–±-—Å–µ—Ä–≤–µ—Ä** (192.168.20.20) - –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–µ–±-—É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
4. **–°–µ—Ä–≤–µ—Ä –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞** (192.168.30.10) - –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
5. **–ë–∏–ª–ª–∏–Ω–≥–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä** (192.168.20.10) - —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤
6. **Kali Linux** (192.168.50.10) - —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ —Ä–µ—Å—É—Ä—Å–æ–≤

## –£–¥–∞–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –º–∞—à–∏–Ω—ã

```bash
# –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –º–∞—à–∏–Ω—É
terraform destroy -target=module.radius_server[0]

# –ò–ª–∏ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ
terraform destroy
```

## –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –¥–ª—è —Ç–µ—Å—Ç–∞

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:

| –ú–∞—à–∏–Ω–∞ | CPU | RAM | –î–∏—Å–∫ |
|--------|-----|-----|------|
| RADIUS —Å–µ—Ä–≤–µ—Ä | 1 | 2 GB | 20 GB |
| Jump-—Å–µ—Ä–≤–µ—Ä | 1 | 1 GB | 20 GB |
| –í–µ–±-—Å–µ—Ä–≤–µ—Ä | 1 | 2 GB | 20 GB |
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ | 1 | 2 GB | 30 GB |
| –ë–∏–ª–ª–∏–Ω–≥ | 2 | 4 GB | 30 GB |
| Kali Linux | 2 | 4 GB | 50 GB |

## –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –û—à–∏–±–∫–∞: "authentication failed"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞ API
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–∞: `user@realm!token-name`

### –û—à–∏–±–∫–∞: "template not found"
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —à–∞–±–ª–æ–Ω `ubuntu-20.04-template` —Å–æ–∑–¥–∞–Ω –≤ Proxmox
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è –≤ `proxmox_template_name`

### –û—à–∏–±–∫–∞: "insufficient resources"
- –£–º–µ–Ω—å—à–∏—Ç–µ CPU, RAM –∏–ª–∏ disk_size –≤ terraform.tfvars
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –≤ Proxmox

### –ù–µ –º–æ–≥—É –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –ø–æ SSH
- –ü–æ–¥–æ–∂–¥–∏—Ç–µ 2-3 –º–∏–Ω—É—Ç—ã –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è (cloud-init)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ SSH –∫–ª—é—á –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Proxmox

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è
terraform show

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–ª–∞–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
terraform plan

# –ü—Ä–æ—Å–º–æ—Ç—Ä outputs (IP –∞–¥—Ä–µ—Å–∞)
terraform output

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
terraform refresh
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ**: `infrastructure/terraform/proxmox/FIRST_RUN.md`
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: `infrastructure/terraform/proxmox/TESTING.md`
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Proxmox**: `infrastructure/terraform/proxmox/PROXMOX_SETUP.md`
- **–û–±—â–µ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ**: `infrastructure/terraform/proxmox/README.md`

---

**üí° –°–æ–≤–µ—Ç**: –ù–∞—á–Ω–∏—Ç–µ —Å `FIRST_RUN.md` - —Ç–∞–º –ø–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞!

---

## –ù–∞–≤–∏–≥–∞—Ü–∏—è

- **[‚Üê –ù–∞–∑–∞–¥ –∫ –≥–ª–∞–≤–Ω–æ–π](../../README.md)** - –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π
- **[–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](QUICKSTART.md)** - –∫—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
- **[–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ](DEPLOYMENT.md)** - –ø–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
- **[–û–±–∑–æ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è](../overview/README.md)** - –æ–ø–∏—Å–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏ —Å–µ—Ç–∏

