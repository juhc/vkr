# Сценарии для виртуальных машин ISP компании

## Обзор сценариев

Сценарий упрощен для удобства обучения и содержит **4 ключевых машины инфраструктуры** (плюс машина атакующего). Каждая машина настроена с определенными уязвимостями и ошибками конфигурации для практического обучения.

## Инфраструктурные серверы

### 1. RADIUS Server (192.168.10.10)

#### Описание
Сервер для аутентификации клиентов провайдера при подключении к сети.

#### Конфигурация
- **ОС**: Ubuntu 20.04 LTS
- **RADIUS**: FreeRADIUS 3.0
- **Backend**: MySQL 5.7
- **Порты**: 1812 (authentication), 1813 (accounting), 3306 (MySQL)

#### Уязвимости операционной системы
1. **Слабые пароли пользователей и администраторов**
   - Пароль пользователя `root`: `admin123`
   - Пароль пользователя `ubuntu`: `ubuntu123`
   - Пароли соответствуют простым словарным словам
   - Отсутствие политики сложности паролей

2. **Устаревшая версия операционной системы**
   - Ubuntu 20.04 LTS с непатченными уязвимостями
   - Отключены автоматические обновления безопасности
   - Не установлены последние security patches
   - Известные CVE не исправлены

3. **Открытые порты управления**
   - SSH (22) доступен из всех сетей
   - MySQL (3306) доступен удаленно без ограничений
   - Telnet (23) включен и доступен
   - Отсутствие правил брандмауэра

4. **Небезопасная конфигурация SSH**
   - Доступ по паролю разрешен (PasswordAuthentication yes)
   - Root login разрешен (PermitRootLogin yes)
   - Отсутствие использования SSH ключей
   - Слабые cipher suites

5. **Неправильные права доступа к файлам**
   - Конфигурационные файлы доступны для чтения всем пользователям
   - Логи содержат чувствительную информацию и доступны широкому кругу пользователей
   - Отсутствие контроля доступа к системным файлам

6. **Отключенные механизмы безопасности**
   - Брандмауэр (ufw) отключен
   - SELinux/AppArmor не настроен
   - Отсутствие логирования критичных событий безопасности

#### Сценарий обучения
1. **Обнаружение уязвимостей ОС**
   - Сканирование открытых портов (nmap)
   - Обнаружение устаревшей версии ОС
   - Проверка конфигурации SSH
   - Анализ прав доступа к файлам
   - Проверка настроек брандмауэра

2. **Эксплуатация уязвимостей ОС**
   - Брутфорс слабых паролей SSH
   - Подключение через SSH с найденными учетными данными
   - Повышение привилегий через уязвимости ОС
   - Доступ к конфигурационным файлам с неправильными правами
   - Извлечение чувствительной информации из логов

3. **Устранение уязвимостей ОС**
   - Установка обновлений безопасности ОС
   - Изменение слабых паролей на сложные
   - Настройка SSH (отключение root login, использование ключей)
   - Настройка брандмауэра (ufw)
   - Исправление прав доступа к файлам (chmod, chown)
   - Включение логирования событий безопасности

---

## Сервисные серверы

### 2. Services Server (192.168.20.10)

#### Описание
Объединенный сервер сервисов, содержащий биллинговую систему и веб-сайт компании.

#### Конфигурация
- **ОС**: Ubuntu 20.04 LTS
- **Веб-сервер**: Apache 2.4.41
- **Приложение**: PHP 7.4
- **База данных**: PostgreSQL 12
- **CMS**: WordPress 5.8 (уязвимая версия)
- **Порты**: 80, 443, 5432, 8080

#### Уязвимости операционной системы

1. **Слабые пароли пользователей и администраторов**
   - Пароль пользователя `root`: `admin123`
   - Пароль пользователя `ubuntu`: `ubuntu123`
   - Пароль пользователя `www-data`: `web123`
   - Пароли соответствуют простым словарным словам
   - Отсутствие политики сложности паролей

2. **Устаревшая версия операционной системы**
   - Ubuntu 20.04 LTS с непатченными уязвимостями
   - Отключены автоматические обновления безопасности
   - Не установлены последние security patches
   - Известные CVE не исправлены (например, CVE-2021-4034, CVE-2021-3156)

3. **Открытые порты управления**
   - SSH (22) доступен из всех сетей
   - PostgreSQL (5432) доступен удаленно без ограничений
   - Telnet (23) включен и доступен
   - RDP (3389) открыт для удаленного доступа
   - Отсутствие правил брандмауэра

4. **Небезопасная конфигурация SSH**
   - Доступ по паролю разрешен (PasswordAuthentication yes)
   - Root login разрешен (PermitRootLogin yes)
   - Отсутствие использования SSH ключей
   - Слабые cipher suites
   - Отсутствие ограничения попыток входа

5. **Неправильные права доступа к файлам**
   - Конфигурационные файлы веб-сервера доступны для чтения всем
   - Файлы с паролями БД имеют неправильные права (chmod 644)
   - Логи содержат чувствительную информацию и доступны широкому кругу пользователей
   - Отсутствие контроля доступа к системным файлам

6. **Отключенные механизмы безопасности**
   - Брандмауэр (ufw) отключен
   - SELinux/AppArmor не настроен или отключен
   - Отсутствие логирования критичных событий безопасности
   - Отключенные обновления безопасности (unattended-upgrades)

7. **Небезопасные протоколы**
   - FTP вместо SFTP для передачи файлов
   - Telnet вместо SSH для удаленного доступа
   - HTTP вместо HTTPS для административных интерфейсов

#### Сценарий обучения
1. **Обнаружение уязвимостей ОС**
   - Сканирование открытых портов (nmap)
   - Обнаружение устаревшей версии ОС
   - Проверка конфигурации SSH
   - Анализ прав доступа к файлам
   - Проверка настроек брандмауэра
   - Обнаружение небезопасных протоколов (Telnet, FTP)

2. **Эксплуатация уязвимостей ОС**
   - Брутфорс слабых паролей SSH
   - Подключение через SSH с найденными учетными данными
   - Повышение привилегий через уязвимости ОС (CVE-2021-4034)
   - Доступ к конфигурационным файлам с неправильными правами
   - Извлечение паролей БД из конфигурационных файлов
   - Доступ к чувствительной информации из логов

3. **Устранение уязвимостей ОС**
   - Установка обновлений безопасности ОС
   - Изменение слабых паролей на сложные
   - Настройка SSH (отключение root login, использование ключей, ограничение попыток)
   - Настройка брандмауэра (ufw) для закрытия ненужных портов
   - Исправление прав доступа к файлам (chmod, chown)
   - Включение логирования событий безопасности
   - Отключение небезопасных протоколов (Telnet, FTP)
   - Настройка автоматических обновлений безопасности

---

## Управляющие серверы

### 3. Management Server (192.168.30.10)

#### Описание
Объединенный сервер управления, содержащий систему мониторинга и jump-сервер для доступа администраторов.

#### Конфигурация
- **ОС**: Ubuntu 20.04 LTS
- **Мониторинг**: Zabbix 5.4
- **SNMP**: Установлен
- **SSH**: OpenSSH 8.2
- **VPN**: OpenVPN установлен
- **Порты**: 80, 443, 10051, 161, 22, 1194

#### Уязвимости операционной системы

1. **Слабые пароли пользователей и администраторов**
   - Пароль пользователя `root`: `admin123`
   - Пароль пользователя `zabbix`: `zabbix123`
   - Пароль пользователя `ubuntu`: `ubuntu123`
   - Пароли соответствуют простым словарным словам
   - Отсутствие политики сложности паролей

2. **Устаревшая версия операционной системы**
   - Ubuntu 20.04 LTS с непатченными уязвимостями
   - Отключены автоматические обновления безопасности
   - Не установлены последние security patches
   - Известные CVE не исправлены

3. **Открытые порты управления**
   - SSH (22) доступен из всех сетей
   - SNMP (161) доступен без ограничений
   - Telnet (23) включен и доступен
   - Отсутствие правил брандмауэра

4. **Небезопасная конфигурация SSH**
   - Доступ по паролю разрешен (PasswordAuthentication yes)
   - Root login разрешен (PermitRootLogin yes)
   - Отсутствие использования SSH ключей
   - Слабые cipher suites
   - Отсутствие ограничения попыток входа
   - Отсутствие 2FA

5. **Неправильные права доступа к файлам**
   - Конфигурационные файлы Zabbix доступны для чтения всем
   - Файлы с паролями имеют неправильные права (chmod 644)
   - Логи содержат чувствительную информацию и доступны широкому кругу пользователей
   - Отсутствие контроля доступа к системным файлам

6. **Отключенные механизмы безопасности**
   - Брандмауэр (ufw) отключен
   - SELinux/AppArmor не настроен
   - Отсутствие логирования критичных событий безопасности
   - Отсутствие fail2ban для защиты от брутфорса
   - Логи не мониторятся на подозрительную активность
   - Отсутствие аудита сессий SSH

#### Сценарий обучения
1. **Обнаружение уязвимостей ОС**
   - Сканирование открытых портов (nmap)
   - Обнаружение устаревшей версии ОС
   - Проверка конфигурации SSH
   - Анализ прав доступа к файлам
   - Проверка настроек брандмауэра
   - Обнаружение небезопасных протоколов (Telnet, SNMP v1/v2c)

2. **Эксплуатация уязвимостей ОС**
   - Брутфорс слабых паролей SSH
   - Подключение через SSH с найденными учетными данными
   - Повышение привилегий через уязвимости ОС
   - Доступ к конфигурационным файлам с неправильными правами
   - Извлечение паролей и чувствительной информации из логов
   - Использование как плацдарма для дальнейших атак

3. **Устранение уязвимостей ОС**
   - Установка обновлений безопасности ОС
   - Изменение слабых паролей на сложные
   - Настройка SSH (отключение root login, использование ключей, ограничение попыток, 2FA)
   - Настройка брандмауэра (ufw) для закрытия ненужных портов
   - Исправление прав доступа к файлам (chmod, chown)
   - Включение логирования событий безопасности
   - Настройка fail2ban для защиты от брутфорса
   - Настройка аудита сессий SSH

---

## Рабочие станции

### 4. Admin Workstation (192.168.30.20)

#### Описание
Рабочая станция администратора с типичными уязвимостями пользовательских компьютеров.

#### Конфигурация
- **ОС**: Ubuntu 20.04 Desktop LTS
- **Роль**: Рабочая станция администратора
- **Сервисы**: SSH, RDP, SMB, FTP
- **Порты**: 22 (SSH), 3389 (RDP), 445 (SMB), 21 (FTP)

#### Уязвимости операционной системы

1. **Слабые пароли пользователей и администраторов**
   - Пароль пользователя `admin`: `admin123`
   - Пароль пользователя `ubuntu`: `ubuntu123`
   - Пароли соответствуют простым словарным словам
   - Отсутствие политики сложности паролей
   - Пароли по умолчанию не изменены

2. **Устаревшая версия операционной системы**
   - Ubuntu 20.04 Desktop LTS с непатченными уязвимостями
   - Отключены автоматические обновления безопасности
   - Не установлены последние security patches
   - Известные CVE не исправлены

3. **Открытые порты управления**
   - SSH (22) доступен из всех сетей
   - RDP (3389) открыт для удаленного доступа
   - SMB (445) доступен без ограничений
   - FTP (21) включен и доступен
   - Отсутствие правил брандмауэра

4. **Небезопасная конфигурация SSH**
   - Доступ по паролю разрешен (PasswordAuthentication yes)
   - Root login разрешен (PermitRootLogin yes)
   - Отсутствие использования SSH ключей
   - Слабые cipher suites

5. **Неправильные права доступа к файлам**
   - Сетевые папки (SMB) доступны без аутентификации
   - Чувствительные данные в открытом доступе
   - Неправильные права доступа к домашним директориям пользователей
   - Отсутствие контроля доступа к системным файлам

6. **Отключенные механизмы безопасности**
   - Брандмауэр (ufw) отключен
   - SELinux/AppArmor не настроен или отключен
   - Отсутствие антивирусной защиты
   - Отсутствие логирования критичных событий безопасности
   - Нет мониторинга подозрительной активности
   - Отключенные автоматические обновления безопасности
   - Отсутствие менеджера паролей

#### Сценарий обучения
1. **Обнаружение**
   - Обнаружение рабочей станции в сети
   - Сканирование открытых портов
   - Обнаружение открытых SMB папок
   - Анализ сохраненных учетных данных

2. **Эксплуатация**
   - Доступ к открытым сетевым папкам
   - Извлечение сохраненных паролей
   - Использование учетных данных для дальнейших атак
   - Компрометация через устаревшее ПО

3. **Устранение**
   - Установка сложных паролей
   - Закрытие сетевых папок
   - Установка и настройка антивируса
   - Очистка сохраненных учетных данных
   - Настройка автоматических обновлений

---

## Машина атакующего

### 5. Kali Linux Pentest Box (192.168.50.10)

#### Описание
Машина атакующего на базе Kali Linux для проведения тестирования на проникновение инфраструктуры ISP компании.

#### Конфигурация
- **ОС**: Kali Linux (последняя версия)
- **Роль**: Машина для пентеста и обучения
- **Сеть**: 192.168.50.0/24
- **IP адрес**: 192.168.50.10
- **Порты**: 22 (SSH), 80 (HTTP для веб-интерфейсов инструментов)

#### Предустановленные инструменты

##### Сканирование и разведка
- **Nmap**: Сканирование портов и обнаружение сервисов
- **Masscan**: Быстрое сканирование больших сетей
- **Zmap**: Сканирование интернета
- **Netdiscover**: Обнаружение хостов в сети
- **Recon-ng**: Фреймворк для разведки

##### Эксплуатация уязвимостей
- **Metasploit Framework**: Фреймворк для эксплуатации уязвимостей
- **ExploitDB**: База данных эксплойтов
- **SearchSploit**: Поиск эксплойтов в ExploitDB
- **SQLMap**: Автоматизация эксплуатации SQL инъекций
- **XSSer**: Эксплуатация XSS уязвимостей

##### Веб-тестирование
- **Burp Suite**: Интегрированная платформа для тестирования веб-приложений
- **OWASP ZAP**: Автоматический сканер уязвимостей веб-приложений
- **Nikto**: Веб-сканер уязвимостей
- **Dirb/Dirbuster**: Перебор директорий веб-серверов
- **Wfuzz**: Веб-фаззер

##### Брутфорс и перебор паролей
- **Hydra**: Брутфорс различных протоколов (SSH, FTP, HTTP, RDP и др.)
- **Medusa**: Быстрый брутфорс различных сервисов
- **John the Ripper**: Взлом хешей паролей
- **Hashcat**: Продвинутый инструмент для взлома хешей
- **Crunch**: Генератор словарей

##### Анализ сетевого трафика
- **Wireshark**: Анализ сетевых пакетов
- **Tcpdump**: Перехват и анализ сетевого трафика
- **Ettercap**: Атаки типа "человек посередине" (MITM)
- **Bettercap**: Фреймворк для MITM атак

##### Анализ уязвимостей
- **OpenVAS**: Комплексное сканирование уязвимостей
- **Nessus**: Коммерческий сканер уязвимостей (если доступен)
- **Lynis**: Аудит безопасности Linux систем
- **OpenSCAP**: Проверка соответствия стандартам безопасности

##### Социальная инженерия
- **Social Engineering Toolkit (SET)**: Набор инструментов для социальной инженерии
- **Phishing**: Создание фишинговых страниц

##### Пост-эксплуатация
- **Mimikatz**: Извлечение паролей из памяти Windows (если есть Windows системы)
- **BloodHound**: Анализ Active Directory (если используется)
- **PowerSploit**: PowerShell инструменты для пост-эксплуатации
- **Empire**: Фреймворк для пост-эксплуатации

##### Беспроводные сети
- **Aircrack-ng**: Взлом WEP/WPA/WPA2
- **Reaver**: Взлом WPS
- **Wifite**: Автоматизация атак на Wi-Fi

##### Другие инструменты
- **Git**: Система контроля версий
- **Python**: Язык программирования с библиотеками для пентеста
- **Go**: Язык программирования
- **Docker**: Контейнеризация (для изоляции инструментов)

#### Учетные данные
- **Пользователь по умолчанию**: `kali`
- **Пароль по умолчанию**: `kali`
- **Root доступ**: Через `sudo su -` или `sudo -i`

#### Доступ к сетям
- Разрешен доступ ко всем тестируемым сетям:
  - Инфраструктурная сеть (192.168.10.0/24)
  - Сервисная сеть (192.168.20.0/24)
  - Управляющая сеть (192.168.30.0/24)
- Разрешен доступ в интернет (для скачивания обновлений и инструментов)

#### Сценарий использования

##### 1. Подготовка к тестированию
```bash
# Обновление системы
sudo apt update && sudo apt upgrade -y

# Проверка сетевого подключения
ping -c 4 192.168.10.10  # RADIUS сервер
ping -c 4 192.168.20.20  # Веб-сервер

# Проверка доступности инструментов
nmap --version
metasploit --version
```

##### 2. Разведка инфраструктуры
```bash
# Сканирование сети
nmap -sn 192.168.10.0/24
nmap -sn 192.168.20.0/24
nmap -sn 192.168.30.0/24

# Сканирование портов на конкретном хосте
nmap -sV -sC -O 192.168.20.20

# Обнаружение веб-серверов
nikto -h http://192.168.20.20
```

##### 3. Тестирование веб-приложений
```bash
# Запуск Burp Suite
burpsuite

# Использование SQLMap
sqlmap -u "http://192.168.20.10/billing?id=1" --dbs

# Сканирование директорий
dirb http://192.168.20.20
```

##### 4. Брутфорс аутентификации
```bash
# Брутфорс SSH
hydra -l admin -P /usr/share/wordlists/rockyou.txt ssh://192.168.30.20

# Брутфорс веб-формы
hydra -l admin -P /usr/share/wordlists/rockyou.txt http-post-form://192.168.20.20/login:username=^USER^&password=^PASS^:Invalid
```

##### 5. Эксплуатация уязвимостей
```bash
# Запуск Metasploit
msfconsole

# Поиск эксплойтов
searchsploit wordpress 5.8
```

##### 6. Анализ трафика
```bash
# Запуск Wireshark
wireshark

# Перехват трафика через tcpdump
sudo tcpdump -i eth0 -w capture.pcap
```

#### Рекомендации по использованию

1. **Безопасность**:
   - Измените пароль по умолчанию при первом входе
   - Используйте SSH ключи вместо паролей
   - Ограничьте доступ к машине только для авторизованных пользователей

2. **Обновления**:
   - Регулярно обновляйте систему и инструменты
   - Обновляйте базы данных эксплойтов: `searchsploit -u`

3. **Документирование**:
   - Ведите журнал всех действий
   - Сохраняйте результаты сканирований
   - Документируйте найденные уязвимости

4. **Этика**:
   - Используйте машину только в изолированной учебной среде
   - Не используйте для атак на реальные системы без разрешения
   - Соблюдайте законы и этические нормы

#### Интеграция с инфраструктурой

Машина атакующего имеет доступ ко всем сетям инфраструктуры:
- **Инфраструктурная сеть** (192.168.10.0/24): Для тестирования RADIUS
- **Сервисная сеть** (192.168.20.0/24): Для тестирования веб-приложений и биллинга
- **Управляющая сеть** (192.168.30.0/24): Для тестирования систем мониторинга и управления

#### Примеры использования для обучения

1. **Начальный уровень**:
   - Сканирование портов с помощью Nmap
   - Обнаружение веб-уязвимостей с помощью Nikto
   - Брутфорс паролей с помощью Hydra

2. **Средний уровень**:
   - Эксплуатация SQL инъекций с помощью SQLMap
   - Использование Metasploit для получения доступа
   - Анализ сетевого трафика с помощью Wireshark

3. **Продвинутый уровень**:
   - Комплексное тестирование всей инфраструктуры
   - Использование цепочек атак
   - Пост-эксплуатация и поддержание доступа

---

## Комплексные сценарии

### Сценарий A: Компрометация через RADIUS сервер
1. Эксплуатация слабого пароля MySQL на RADIUS сервере
2. Извлечение учетных данных клиентов
3. Использование учетных данных для доступа к клиентскому порталу
4. Модификация данных клиентов в биллинге
5. Использование данных для дальнейших атак

### Сценарий B: Утечка данных через биллинговую систему
1. Эксплуатация SQL инъекции в биллинге
2. Извлечение персональных данных клиентов
3. Извлечение платежной информации
4. Использование данных для фишинга
5. Обнаружение и расследование инцидента

### Сценарий C: Атака через веб-портал
1. Эксплуатация уязвимостей WordPress
2. Получение доступа к веб-серверу
3. Перемещение к базе данных
4. Извлечение данных клиентов
5. Компрометация других систем

### Сценарий D: Компрометация через сервер мониторинга
1. Обнаружение слабых SNMP community strings
2. Получение информации о серверах через SNMP
3. Доступ к веб-интерфейсу Zabbix
4. Извлечение информации об инфраструктуре
5. Использование информации для дальнейших атак

### Сценарий E: Комплексная атака - от веб-сервера к критичным системам
1. Компрометация веб-сервера через WordPress
2. Извлечение учетных данных из базы данных
3. Доступ к биллинговому серверу
4. Компрометация RADIUS сервера
5. Извлечение данных всех клиентов

## Методические рекомендации

### Для начинающих
- Начните с простых сценариев (слабые пароли, SQL инъекции)
- Используйте готовые инструменты для сканирования
- Фокусируйтесь на обнаружении уязвимостей в веб-приложениях

### Для среднего уровня
- Комбинируйте несколько уязвимостей
- Используйте цепочки атак через разные системы
- Фокусируйтесь на эксплуатации и пост-эксплуатации

### Для продвинутых
- Проводите комплексные пентесты всей инфраструктуры
- Используйте сетевые атаки (SNMP, DNS, NTP)
- Фокусируйтесь на обнаружении и реагировании на инциденты
- Анализируйте логи и метрики для обнаружения атак
- Используйте цепочки атак через разные системы

---

## Навигация

- **[← Назад к главной](../../README.md)** - главная страница с навигацией
- **[Обзор сценария](README.md)** - описание организации и сети
- **[Сетевая топология](network-topology.md)** - детальное описание сети
- **[Цели обучения](../learning/objectives.md)** - цели обучения и задачи
- **[Чек-листы](../assessment/CHECKLISTS.md)** - критерии оценки работ
