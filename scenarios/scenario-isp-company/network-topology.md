# Детальная сетевая топология ISP компании

## Схема сети

```
                            Internet (Upstream Providers)
                                    |
                            [Firewall/Gateway]
                                    |
        +---------------------------+---------------------------+---------------------------+---------------------------+
        |                           |                           |                           |                           |
    [Client]                  [Infrastructure]            [Services]                  [Management]              [Workstations]
    Network                       Network                    Network                    Network                    Network
  (10.0.0.0/8)            (192.168.10.0/24)          (192.168.20.0/24)          (192.168.30.0/24)          (192.168.40.0/24)
        |                           |                           |                           |                           |
    +---+---+                   +---+---+                   +---+---+                   +---+---+                   +---+---+
    |       |                   |       |                   |       |                   |       |                   |       |
  PPPoE  DHCP              AD   RADIUS  DNS  NTP        Billing  Web  Mail  CRM      Monitor Jump Backup        Win10 Win10 Win10
  Server Server          Server Server Server Server    Server Server Server Server  Server Server Server        WS   WS   WS
```

## Детальное описание сетевых сегментов

### Клиентская сеть (Client Network) - 10.0.0.0/8

#### Назначение
Подключение клиентов через различные технологии доступа (PPPoE, DHCP, статические IP).

#### Шлюз: 192.168.10.1
#### Маска подсети: Переменная (в зависимости от тарифа клиента)

| IP адрес | Имя хоста | Роль | ОС | Сервисы | Открытые порты | Уязвимости |
|----------|-----------|------|----|---------|----------------|------------|
| 192.168.10.10 | pppoe-server | PPPoE сервер | Ubuntu 20.04 | pppd, radius-client | 1723, 1812, 1813 | Слабые пароли администраторов, небезопасная конфигурация |
| 192.168.10.20 | dhcp-server | DHCP сервер | Ubuntu 20.04 | ISC DHCP Server | 67, 68 | Отсутствие rate limiting, возможность истощения пула |

**Диапазоны IP для клиентов**:
- PPPoE клиенты: 10.0.1.0/24 - 10.0.100.0/24 (до 100 подсетей)
- DHCP клиенты: 10.1.0.0/16 (динамические адреса)
- Статические IP: 10.2.0.0/16 (выделенные адреса)

**Правила брандмауэра клиентской сети**:
- Разрешен входящий трафик: Только установленные соединения
- Разрешен исходящий трафик: Весь (доступ в интернет)
- Запрещен доступ между клиентами: Да (изоляция клиентов)
- Запрещен доступ к инфраструктурной сети: Да

---

### Инфраструктурная сеть (Infrastructure Network) - 192.168.10.0/24

#### Назначение
Критичные сервисы для работы провайдера: аутентификация, DNS, синхронизация времени.

#### Шлюз: 192.168.10.1
#### Маска подсети: 255.255.255.0

| IP адрес | Имя хоста | Роль | ОС | Сервисы | Открытые порты | Уязвимости |
|----------|-----------|------|----|---------|----------------|------------|
| 192.168.10.30 | ad-server | Active Directory Domain Controller | Windows Server 2019 | AD DS, DNS, DHCP | 53, 88, 135, 389, 445, 636, 3268, 3269, 3389 | Слабые пароли администраторов, SMBv1 включен, необновленное ПО, открытый RDP |
| 192.168.10.40 | radius-server | RADIUS сервер | Ubuntu 20.04 | FreeRADIUS, MySQL | 1812, 1813, 3306 | Слабый пароль БД, небезопасная конфигурация |
| 192.168.10.50 | dns-server | DNS сервер | Ubuntu 20.04 | BIND9 | 53 | Открытый рекурсивный DNS, отсутствие rate limiting |
| 192.168.10.60 | ntp-server | NTP сервер | Ubuntu 20.04 | NTPd | 123 | Открытый доступ, возможность NTP amplification |

**Правила брандмауэра инфраструктурной сети**:
- Разрешен входящий трафик: Только от клиентских серверов (PPPoE, DHCP)
- Разрешен входящий трафик: От рабочих станций (для аутентификации в AD)
- Разрешен исходящий трафик: Весь (для синхронизации и обновлений)
- Запрещен доступ из клиентской сети: Да
- Разрешен доступ из управляющей сети: Да (для администрирования)

---

### Сервисная сеть (Services Network) - 192.168.20.0/24

#### Назначение
Публичные сервисы для клиентов и сотрудников: биллинг, веб-сайт, почта, CRM.

#### Шлюз: 192.168.20.1
#### Маска подсети: 255.255.255.0

| IP адрес | Имя хоста | Роль | ОС | Сервисы | Открытые порты | Уязвимости |
|----------|-----------|------|----|---------|----------------|------------|
| 192.168.20.10 | billing-server | Биллинговый сервер | Windows Server 2019 | IIS, ASP.NET, SQL Server | 80, 443, 1433, 3389 | Слабые пароли БД, SQL инъекции, необновленное ПО, открытый RDP |
| 192.168.20.20 | web-server | Веб-сервер | Ubuntu 20.04 | Apache, PHP, CMS | 80, 443, 8080 | Устаревшая версия CMS, SQL инъекции, XSS |
| 192.168.20.30 | mail-server | Почтовый сервер | Ubuntu 20.04 | Postfix, Dovecot | 25, 587, 993, 995 | Открытый релей, слабые пароли |
| 192.168.20.40 | crm-server | CRM сервер | Windows Server 2019 | IIS, ASP.NET, SQL Server | 80, 443, 1433, 3389 | Уязвимая версия CRM, слабые пароли администраторов, открытый RDP |

**Правила брандмауэра сервисной сети**:
- Разрешен входящий трафик из интернета: 80, 443 (веб-сервер, CRM, биллинг)
- Разрешен входящий трафик из интернета: 25, 587, 993, 995 (почтовый сервер)
- Разрешен входящий трафик из внутренней сети: Весь (для сотрудников)
- Разрешен исходящий трафик: Весь

---

### Управляющая сеть (Management Network) - 192.168.30.0/24

#### Назначение
Управление инфраструктурой: мониторинг, администрирование, резервное копирование.

#### Шлюз: 192.168.30.1
#### Маска подсети: 255.255.255.0

| IP адрес | Имя хоста | Роль | ОС | Сервисы | Открытые порты | Уязвимости |
|----------|-----------|------|----|---------|----------------|------------|
| 192.168.30.10 | monitoring-server | Сервер мониторинга | Ubuntu 20.04 | Zabbix, SNMP | 80, 443, 10051, 161 | Слабые SNMP community strings, открытый веб-интерфейс, слабые пароли |
| 192.168.30.20 | jump-server | Jump-сервер | Ubuntu 20.04 | SSH, OpenVPN | 22, 1194 | Доступ по паролю, отсутствие 2FA |
| 192.168.30.30 | backup-server | Сервер резервного копирования | Ubuntu 20.04 | Rsync, BackupPC | 22, 873 | Нешифрованные бэкапы, слабые пароли SSH |

**Правила брандмауэра управляющей сети**:
- Разрешен входящий трафик: Только из доверенных сетей (рабочие станции администраторов)
- Разрешен исходящий трафик: Весь (для мониторинга и бэкапов)
- Запрещен доступ из других сетей: Да (полная изоляция)

---

### Сеть атакующего (Attacker Network) - 192.168.50.0/24

#### Назначение
Машина для проведения тестирования на проникновение и обучения навыкам кибербезопасности.

#### Шлюз: 192.168.50.1
#### Маска подсети: 255.255.255.0

| IP адрес | Имя хоста | Роль | ОС | Сервисы | Открытые порты | Описание |
|----------|-----------|------|----|---------|----------------|----------|
| 192.168.50.10 | kali-attacker | Машина атакующего | Kali Linux (последняя версия) | Инструменты для пентеста | 22 (SSH), 80 (HTTP для веб-интерфейсов инструментов) | Предустановленные инструменты для тестирования на проникновение |

**Предустановленные инструменты**:
- **Сканирование и разведка**: Nmap, Masscan, Zmap, Netdiscover, Recon-ng
- **Эксплуатация**: Metasploit Framework, ExploitDB, SearchSploit, SQLMap, XSSer
- **Веб-тестирование**: Burp Suite, OWASP ZAP, Nikto, Dirb/Dirbuster, Wfuzz
- **Брутфорс**: Hydra, Medusa, John the Ripper, Hashcat, Crunch
- **Анализ трафика**: Wireshark, Tcpdump, Ettercap, Bettercap
- **Анализ уязвимостей**: OpenVAS, Nessus (если доступен), Lynis, OpenSCAP
- **Социальная инженерия**: Social Engineering Toolkit (SET)
- **Пост-эксплуатация**: Mimikatz, BloodHound, PowerSploit, Empire
- **Беспроводные сети**: Aircrack-ng, Reaver, Wifite
- **Другие**: Git, Python, Go, Docker

**Доступ к сетям**:
- Разрешен доступ ко всем тестируемым сетям (Client, Infrastructure, Services, Management)
- Разрешен доступ в интернет (для скачивания обновлений и инструментов)
- Разрешен исходящий трафик: Весь

**Правила брандмауэра сети атакующего**:
- Разрешен входящий трафик: Только установленные соединения (для обратных оболочек)
- Разрешен исходящий трафик: Весь (для проведения атак)
- Разрешен доступ ко всем тестируемым сетям: Да
- Разрешен доступ в интернет: Да

**Учетные данные по умолчанию**:
- Пользователь: `kali` или `root`
- Пароль: `kali` (рекомендуется изменить при развертывании)

**Рекомендации по использованию**:
1. Машина предназначена исключительно для учебных целей
2. Все действия должны проводиться в изолированной среде
3. Рекомендуется использовать отдельный пользователь для работы (не root)
4. Регулярно обновлять инструменты: `apt update && apt upgrade`
5. Использовать VPN или прокси при необходимости скрыть источник атак

---

### Сеть рабочих станций (Workstations Network) - 192.168.40.0/24

#### Назначение
Рабочие станции сотрудников компании.

#### Шлюз: 192.168.40.1
#### Маска подсети: 255.255.255.0

| Диапазон IP | Количество | Роль | ОС | Уязвимости |
|-------------|------------|------|----|------------|
| 192.168.40.10-192.168.40.30 | 20 рабочих станций | Рабочие места сотрудников | Windows 10 Home/Pro (разные версии) | Необновленное ПО, отключенный Windows Update, слабые пароли, открытые сетевые порты, отсутствие антивируса, учетные данные в открытом виде |

**Детализация рабочих станций**:

| IP адрес | Имя хоста | Пользователь | Роль | ОС | Уязвимости |
|----------|-----------|--------------|------|----|------------|
| 192.168.40.10 | ws-director | director | Директор | Windows 10 Pro | Необновленное ПО, слабый пароль, открытый RDP |
| 192.168.40.11 | ws-engineer | engineer | Главный инженер | Windows 10 Pro | Необновленное ПО, слабый пароль, учетные данные в файлах |
| 192.168.40.12 | ws-admin1 | admin1 | Системный администратор | Windows 10 Pro | Необновленное ПО, слабый пароль, локальный администратор |
| 192.168.40.13 | ws-admin2 | admin2 | Системный администратор | Windows 10 Pro | Необновленное ПО, слабый пароль, локальный администратор |
| 192.168.40.14 | ws-admin3 | admin3 | Системный администратор | Windows 10 Pro | Необновленное ПО, слабый пароль, локальный администратор |
| 192.168.40.15 | ws-network1 | network1 | Сетевой инженер | Windows 10 Pro | Необновленное ПО, слабый пароль |
| 192.168.40.16 | ws-network2 | network2 | Сетевой инженер | Windows 10 Pro | Необновленное ПО, слабый пароль |
| 192.168.40.17 | ws-support1 | support1 | Техническая поддержка | Windows 10 Home | Необновленное ПО, слабый пароль, отсутствие антивируса |
| 192.168.40.18 | ws-support2 | support2 | Техническая поддержка | Windows 10 Home | Необновленное ПО, слабый пароль, отсутствие антивируса |
| 192.168.40.19 | ws-sales1 | sales1 | Менеджер по продажам | Windows 10 Home | Необновленное ПО, слабый пароль, учетные данные в браузере |
| 192.168.40.20 | ws-sales2 | sales2 | Менеджер по продажам | Windows 10 Home | Необновленное ПО, слабый пароль, учетные данные в браузере |
| 192.168.40.21 | ws-sales3 | sales3 | Менеджер по продажам | Windows 10 Home | Необновленное ПО, слабый пароль, учетные данные в браузере |
| 192.168.40.22 | ws-client1 | client1 | Менеджер по работе с клиентами | Windows 10 Home | Необновленное ПО, слабый пароль |
| 192.168.40.23 | ws-client2 | client2 | Менеджер по работе с клиентами | Windows 10 Home | Необновленное ПО, слабый пароль |
| 192.168.40.24 | ws-accountant | accountant | Главный бухгалтер | Windows 10 Pro | Необновленное ПО, слабый пароль, учетные данные в файлах |
| 192.168.40.25 | ws-accountant2 | accountant2 | Бухгалтер | Windows 10 Home | Необновленное ПО, слабый пароль |
| 192.168.40.26 | ws-marketing | marketing | Маркетолог | Windows 10 Home | Необновленное ПО, слабый пароль |
| 192.168.40.27 | ws-webmaster | webmaster | Веб-мастер | Windows 10 Pro | Необновленное ПО, слабый пароль, учетные данные в файлах |

**Правила брандмауэра сети рабочих станций**:
- Разрешен входящий трафик: Только установленные соединения
- Разрешен исходящий трафик: Весь (для работы)
- Разрешен доступ к сервисной сети: Да (для доступа к сервисам)
- Разрешен доступ к инфраструктурной сети: Да (для аутентификации в AD)
- Запрещен доступ к управляющей сети: Да (только для администраторов)

---

## Правила межсетевого экрана

### Клиентская сеть → Инфраструктурная сеть
- Разрешен: RADIUS запросы (1812, 1813) от PPPoE/DHCP серверов
- Разрешен: DNS запросы (53) от клиентов
- Запрещен: Весь остальной трафик

### Клиентская сеть → Сервисная сеть
- Разрешен: HTTP/HTTPS (80, 443) к веб-серверу и CRM
- Разрешен: SMTP/IMAP (25, 587, 993, 995) к почтовому серверу
- Запрещен: Доступ к биллинговому серверу

### Инфраструктурная сеть → Сервисная сеть
- Разрешен: Подключения к базе данных (1433, 3306, 5432) от серверов
- Разрешен: Веб-доступ (80, 443) для управления
- Запрещен: Весь остальной трафик

### Сеть рабочих станций → Все сети
- Разрешен: Доступ к сервисной сети (80, 443, 3389 для RDP)
- Разрешен: Доступ к инфраструктурной сети (для аутентификации в AD)
- Разрешен: Доступ к управляющей сети (только для администраторов)
- Запрещен: Доступ к клиентской сети

### Управляющая сеть → Все сети
- Разрешен: SSH (22), RDP (3389), SNMP (161)
- Разрешен: Веб-доступ к системам мониторинга
- Запрещен: Весь остальной трафик

### Сеть атакующего → Все сети
- Разрешен: Весь трафик (для проведения тестирования на проникновение)
- Разрешен: Доступ к клиентской сети (для тестирования клиентских серверов)
- Разрешен: Доступ к инфраструктурной сети (для тестирования критичных сервисов)
- Разрешен: Доступ к сервисной сети (для тестирования веб-приложений и сервисов)
- Разрешен: Доступ к управляющей сети (для тестирования систем управления)
- Разрешен: Доступ в интернет (для скачивания инструментов и обновлений)

---

## DNS конфигурация

### Внутренние DNS записи

| Имя | Тип | Значение | Зона | Описание |
|-----|-----|----------|------|----------|
| internetplus.local | A | 192.168.20.20 | internetplus.local | Основной домен |
| www.internetplus.local | A | 192.168.20.20 | internetplus.local | Веб-сайт |
| billing.internetplus.local | A | 192.168.20.10 | internetplus.local | Биллинг |
| mail.internetplus.local | A | 192.168.20.30 | internetplus.local | Почта |
| crm.internetplus.local | A | 192.168.20.40 | internetplus.local | CRM |
| ad.internetplus.local | A | 192.168.10.30 | internetplus.local | Active Directory |
| radius.internetplus.local | A | 192.168.10.40 | internetplus.local | RADIUS |
| dns.internetplus.local | A | 192.168.10.50 | internetplus.local | DNS |
| monitor.internetplus.local | A | 192.168.30.10 | internetplus.local | Мониторинг |

### Публичные DNS записи

| Имя | Тип | Значение | Описание |
|-----|-----|----------|----------|
| internetplus.ru | A | 203.0.113.10 | Основной домен |
| www.internetplus.ru | A | 203.0.113.10 | Веб-сайт |
| mail.internetplus.ru | A | 203.0.113.11 | Почтовый сервер |

---

## DHCP конфигурация

### Клиентская сеть (10.1.0.0/16)
- Диапазон: 10.1.0.100 - 10.1.255.254
- Шлюз: 10.1.0.1
- DNS: 192.168.10.50, 8.8.8.8
- Аренда: 24 часа
- Опции: Router, DNS, Domain Name

### Инфраструктурная сеть (192.168.10.0/24)
- Диапазон: 192.168.10.100 - 192.168.10.200
- Шлюз: 192.168.10.1
- DNS: 192.168.10.30 (AD), 192.168.10.50, 8.8.8.8
- Аренда: 12 часов

### Сеть рабочих станций (192.168.40.0/24)
- Диапазон: 192.168.40.100 - 192.168.40.200
- Шлюз: 192.168.40.1
- DNS: 192.168.10.30 (AD), 192.168.10.50, 8.8.8.8
- Аренда: 8 часов

---

## Active Directory конфигурация

### Домен
- **Имя домена**: internetplus.local
- **NetBIOS имя**: INTERNETPLUS
- **Функциональный уровень**: Windows Server 2016

### Учетные записи
- **Администраторы домена**: 
  - Administrator (слабый пароль: `Admin123!`)
  - engineer, admin1, admin2, admin3 (в группе Domain Admins)
- **Обычные пользователи**: Все сотрудники компании

### Уязвимости
- Слабые пароли администраторов
- SMBv1 включен (уязвим к EternalBlue)
- NTLM используется вместо Kerberos
- Отсутствие политики сложности паролей
- Пользователи в группе Domain Admins без необходимости
- Открытый RDP на Domain Controller

---

## Безопасность сети

### Реализованные меры
- ✅ Сегментация сети на подсети
- ✅ Брандмауэр между сегментами
- ✅ NAT для выхода в интернет
- ✅ Изоляция клиентов друг от друга

### Отсутствующие меры (для обучения)
- ❌ Шифрование трафика между сегментами
- ❌ IDS/IPS система
- ❌ Централизованное логирование
- ❌ Система обнаружения аномалий
- ❌ Двухфакторная аутентификация
- ❌ Регулярные аудиты безопасности
- ❌ Защита от DDoS атак
- ❌ Мониторинг сетевого трафика
- ❌ Антивирус на рабочих станциях
- ❌ Централизованное управление обновлениями

---

## Специфика ISP инфраструктуры

### Клиентские подключения
- **PPPoE**: Для клиентов с динамическими IP
- **DHCP**: Для клиентов с выделенными IP
- **Статические IP**: Для корпоративных клиентов

### Аутентификация клиентов
- **RADIUS**: Централизованная аутентификация
- **База данных**: Хранение учетных записей клиентов
- **Тарифы**: Различные скорости и лимиты трафика

### Аутентификация сотрудников
- **Active Directory**: Централизованная аутентификация сотрудников
- **Доменная среда**: Все рабочие станции в домене
- **Единый вход**: SSO для корпоративных приложений

### Мониторинг
- **Zabbix**: Мониторинг серверов и сервисов
- **SNMP**: Мониторинг систем
- **Логирование**: Централизованное логирование событий
- **Windows Event Log**: Логирование событий на Windows системах
