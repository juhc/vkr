# Детальная сетевая топология ISP компании

## Схема сети

```
                            Internet (Upstream Providers)
                                    |
                            [Border Router] (203.0.113.1)
                                    |
                            [Core Router] (192.168.1.1)
                                    |
        +---------------------------+---------------------------+---------------------------+
        |                           |                           |                           |
    [Client]                  [Infrastructure]            [Services]                  [Management]
    Network                       Network                    Network                    Network
  (10.0.0.0/8)            (192.168.10.0/24)          (192.168.20.0/24)          (192.168.30.0/24)
        |                           |                           |                           |
    +---+---+                   +---+---+                   +---+---+                   +---+---+
    |       |                   |       |                   |       |                   |       |
  PPPoE  DHCP              RADIUS  DNS  NTP            Billing Web Mail CRM        Monitor Jump Backup
  Server Server             Server Server Server        Server Server Server Server Server Server Server
```

## Детальное описание сетевых сегментов

### Клиентская сеть (Client Network) - 10.0.0.0/8

#### Назначение
Подключение клиентов через различные технологии доступа (PPPoE, DHCP, статические IP).

#### Шлюз: 192.168.10.1
#### Маска подсети: Переменная (в зависимости от тарифа клиента)

| IP адрес | Имя хоста | Роль | ОС | Сервисы | Открытые порты | Уязвимости |
|----------|-----------|------|----|---------|----------------|------------|
| 192.168.10.10 | pppoe-server | PPPoE сервер | Ubuntu 20.04 | pppd, radius-client | 1723, 1812, 1813 | Слабые пароли администраторов, небезопасная конфигурация |
| 192.168.10.20 | dhcp-server | DHCP сервер | Ubuntu 20.04 | ISC DHCP Server | 67, 68 | Отсутствие rate limiting, возможность истощения пула |

**Диапазоны IP для клиентов**:
- PPPoE клиенты: 10.0.1.0/24 - 10.0.100.0/24 (до 100 подсетей)
- DHCP клиенты: 10.1.0.0/16 (динамические адреса)
- Статические IP: 10.2.0.0/16 (выделенные адреса)

**Правила брандмауэра клиентской сети**:
- Разрешен входящий трафик: Только установленные соединения
- Разрешен исходящий трафик: Весь (доступ в интернет)
- Запрещен доступ между клиентами: Да (изоляция клиентов)
- Запрещен доступ к инфраструктурной сети: Да

---

### Инфраструктурная сеть (Infrastructure Network) - 192.168.10.0/24

#### Назначение
Критичные сервисы для работы провайдера: аутентификация, DNS, синхронизация времени.

#### Шлюз: 192.168.10.1
#### Маска подсети: 255.255.255.0

| IP адрес | Имя хоста | Роль | ОС | Сервисы | Открытые порты | Уязвимости |
|----------|-----------|------|----|---------|----------------|------------|
| 192.168.10.30 | radius-server | RADIUS сервер | Ubuntu 20.04 | FreeRADIUS, MySQL | 1812, 1813, 3306 | Слабый пароль БД, небезопасная конфигурация |
| 192.168.10.40 | dns-server | DNS сервер | Ubuntu 20.04 | BIND9 | 53 | Открытый рекурсивный DNS, отсутствие rate limiting |
| 192.168.10.50 | ntp-server | NTP сервер | Ubuntu 20.04 | NTPd | 123 | Открытый доступ, возможность NTP amplification |

**Правила брандмауэра инфраструктурной сети**:
- Разрешен входящий трафик: Только от клиентских серверов (PPPoE, DHCP)
- Разрешен исходящий трафик: Весь (для синхронизации и обновлений)
- Запрещен доступ из клиентской сети: Да
- Разрешен доступ из управляющей сети: Да (для администрирования)

---

### Сервисная сеть (Services Network) - 192.168.20.0/24

#### Назначение
Публичные сервисы для клиентов и сотрудников: биллинг, веб-сайт, почта, CRM.

#### Шлюз: 192.168.20.1
#### Маска подсети: 255.255.255.0

| IP адрес | Имя хоста | Роль | ОС | Сервисы | Открытые порты | Уязвимости |
|----------|-----------|------|----|---------|----------------|------------|
| 192.168.20.10 | billing-server | Биллинговый сервер | Ubuntu 20.04 | Биллинговая система, PostgreSQL | 80, 443, 5432 | Слабые пароли БД, SQL инъекции, необновленное ПО |
| 192.168.20.20 | web-server | Веб-сервер | Ubuntu 20.04 | Apache, PHP, CMS | 80, 443, 8080 | Устаревшая версия CMS, SQL инъекции, XSS |
| 192.168.20.30 | mail-server | Почтовый сервер | Ubuntu 20.04 | Postfix, Dovecot | 25, 587, 993, 995 | Открытый релей, слабые пароли |
| 192.168.20.40 | crm-server | CRM сервер | Ubuntu 20.04 | CRM система, веб-интерфейс | 80, 443 | Уязвимая версия CRM, слабые пароли администраторов |

**Правила брандмауэра сервисной сети**:
- Разрешен входящий трафик из интернета: 80, 443 (веб-сервер, CRM)
- Разрешен входящий трафик из интернета: 25, 587, 993, 995 (почтовый сервер)
- Разрешен входящий трафик из внутренней сети: Весь (для сотрудников)
- Разрешен исходящий трафик: Весь

---

### Управляющая сеть (Management Network) - 192.168.30.0/24

#### Назначение
Управление инфраструктурой: мониторинг, администрирование, резервное копирование.

#### Шлюз: 192.168.30.1
#### Маска подсети: 255.255.255.0

| IP адрес | Имя хоста | Роль | ОС | Сервисы | Открытые порты | Уязвимости |
|----------|-----------|------|----|---------|----------------|------------|
| 192.168.30.10 | monitoring-server | Сервер мониторинга | Ubuntu 20.04 | Zabbix, SNMP | 80, 443, 10051, 161 | Слабые SNMP community strings, открытый веб-интерфейс |
| 192.168.30.20 | jump-server | Jump-сервер | Ubuntu 20.04 | SSH, OpenVPN | 22, 1194 | Доступ по паролю, отсутствие 2FA |
| 192.168.30.30 | backup-server | Сервер резервного копирования | Ubuntu 20.04 | Rsync, BackupPC | 22, 873 | Нешифрованные бэкапы, слабые пароли SSH |

**Правила брандмауэра управляющей сети**:
- Разрешен входящий трафик: Только из доверенных сетей
- Разрешен исходящий трафик: Весь (для мониторинга и бэкапов)
- Запрещен доступ из других сетей: Да (полная изоляция)

---

## Сетевое оборудование

### Маршрутизаторы и коммутаторы

| Устройство | IP адрес | Модель | Роль | Конфигурация | Уязвимости |
|------------|----------|--------|------|--------------|------------|
| Border Router | 203.0.113.1 | Cisco ASR 1000 | Пограничный маршрутизатор | BGP, NAT, Firewall | Слабые пароли, SNMP v2c |
| Core Router | 192.168.1.1 | Cisco 7200 | Основной маршрутизатор | OSPF, VLAN routing | Telnet вместо SSH, слабые пароли |
| Access Switch | 192.168.10.1 | Cisco Catalyst 2960 | Коммутатор доступа | VLAN, Port security | Слабые пароли, отсутствие портовой безопасности |
| Services Switch | 192.168.20.1 | Cisco Catalyst 2960 | Коммутатор сервисов | VLAN 20 | Открытые порты управления |
| Management Switch | 192.168.30.1 | Cisco Catalyst 2960 | Коммутатор управления | VLAN 30 | Слабые пароли |

### Таблица маршрутизации

| Сеть назначения | Маска | Шлюз | Интерфейс | Метрика | Описание |
|-----------------|-------|------|-----------|---------|----------|
| 10.0.0.0 | 255.0.0.0 | 192.168.10.1 | eth0 | 10 | Клиентская сеть |
| 192.168.10.0 | 255.255.255.0 | 192.168.10.1 | eth1 | 10 | Инфраструктурная сеть |
| 192.168.20.0 | 255.255.255.0 | 192.168.20.1 | eth2 | 10 | Сервисная сеть |
| 192.168.30.0 | 255.255.255.0 | 192.168.30.1 | eth3 | 10 | Управляющая сеть |
| 0.0.0.0 | 0.0.0.0 | 203.0.113.1 | eth4 | 1 | Интернет (default route) |

---

## Правила межсетевого экрана

### Клиентская сеть → Инфраструктурная сеть
- Разрешен: RADIUS запросы (1812, 1813) от PPPoE/DHCP серверов
- Разрешен: DNS запросы (53) от клиентов
- Запрещен: Весь остальной трафик

### Клиентская сеть → Сервисная сеть
- Разрешен: HTTP/HTTPS (80, 443) к веб-серверу и CRM
- Разрешен: SMTP/IMAP (25, 587, 993, 995) к почтовому серверу
- Запрещен: Доступ к биллинговому серверу

### Инфраструктурная сеть → Сервисная сеть
- Разрешен: Подключения к базе данных (5432) от RADIUS сервера
- Разрешен: Веб-доступ (80, 443) для управления
- Запрещен: Весь остальной трафик

### Управляющая сеть → Все сети
- Разрешен: SSH (22), SNMP (161), RDP (3389)
- Разрешен: Веб-доступ к системам мониторинга
- Запрещен: Весь остальной трафик

---

## DNS конфигурация

### Внутренние DNS записи

| Имя | Тип | Значение | Зона | Описание |
|-----|-----|----------|------|----------|
| internetplus.local | A | 192.168.20.20 | internetplus.local | Основной домен |
| www.internetplus.local | A | 192.168.20.20 | internetplus.local | Веб-сайт |
| billing.internetplus.local | A | 192.168.20.10 | internetplus.local | Биллинг |
| mail.internetplus.local | A | 192.168.20.30 | internetplus.local | Почта |
| crm.internetplus.local | A | 192.168.20.40 | internetplus.local | CRM |
| radius.internetplus.local | A | 192.168.10.30 | internetplus.local | RADIUS |
| dns.internetplus.local | A | 192.168.10.40 | internetplus.local | DNS |
| monitor.internetplus.local | A | 192.168.30.10 | internetplus.local | Мониторинг |

### Публичные DNS записи

| Имя | Тип | Значение | Описание |
|-----|-----|----------|----------|
| internetplus.ru | A | 203.0.113.10 | Основной домен |
| www.internetplus.ru | A | 203.0.113.10 | Веб-сайт |
| mail.internetplus.ru | A | 203.0.113.11 | Почтовый сервер |

---

## DHCP конфигурация

### Клиентская сеть (10.1.0.0/16)
- Диапазон: 10.1.0.100 - 10.1.255.254
- Шлюз: 10.1.0.1
- DNS: 192.168.10.40, 8.8.8.8
- Аренда: 24 часа
- Опции: Router, DNS, Domain Name

### Инфраструктурная сеть (192.168.10.0/24)
- Диапазон: 192.168.10.100 - 192.168.10.200
- Шлюз: 192.168.10.1
- DNS: 192.168.10.40, 8.8.8.8
- Аренда: 12 часов

---

## VLAN конфигурация

| VLAN ID | Имя | Подсеть | Описание | Доступ |
|---------|-----|---------|----------|--------|
| 10 | Client | 10.0.0.0/8 | Клиентская сеть | Изолирована |
| 20 | Infrastructure | 192.168.10.0/24 | Инфраструктурная сеть | Ограниченный |
| 30 | Services | 192.168.20.0/24 | Сервисная сеть | Публичный |
| 40 | Management | 192.168.30.0/24 | Управляющая сеть | Полная изоляция |
| 99 | Native | 192.168.99.0/24 | Native VLAN | Только управление |

---

## RADIUS конфигурация

### Настройки аутентификации
- Протокол: RADIUS
- Порт: 1812 (authentication), 1813 (accounting)
- Backend: MySQL
- Методы аутентификации: PAP, CHAP, MS-CHAPv2

### Уязвимости
- Слабый пароль базы данных: `radius123`
- Отсутствие шифрования соединений
- Небезопасная конфигурация атрибутов

---

## Безопасность сети

### Реализованные меры
- ✅ Сегментация сети на VLAN
- ✅ Брандмауэр между сегментами
- ✅ NAT для выхода в интернет
- ✅ Изоляция клиентов друг от друга

### Отсутствующие меры (для обучения)
- ❌ Шифрование трафика между сегментами
- ❌ IDS/IPS система
- ❌ Централизованное логирование
- ❌ Система обнаружения аномалий
- ❌ Двухфакторная аутентификация
- ❌ Регулярные аудиты безопасности
- ❌ Защита от DDoS атак
- ❌ Мониторинг сетевого трафика

---

## Специфика ISP инфраструктуры

### Клиентские подключения
- **PPPoE**: Для клиентов с динамическими IP
- **DHCP**: Для клиентов с выделенными IP
- **Статические IP**: Для корпоративных клиентов

### Аутентификация клиентов
- **RADIUS**: Централизованная аутентификация
- **База данных**: Хранение учетных записей клиентов
- **Тарифы**: Различные скорости и лимиты трафика

### Мониторинг
- **SNMP**: Мониторинг сетевого оборудования
- **Zabbix**: Мониторинг серверов и сервисов
- **Логирование**: Централизованное логирование событий


